.head 0 +  Application Description: GHS Application module

Galilei  Software  GmbH

AD@12.10.2006: 
.data CLASSPROPSSIZE
0000: F000
.enddata
.data CLASSPROPS
0000: 5761746368566172 7300A4006E583100 6E5832006E593100 6E5932006E57006E
0020: 573100636253686F 77416C6C4C54006E 48006E4831006C50 6172616D006E4B6F
0040: 6566006E4B6F6566 546F6F6C62617253 617665006853716C 006E46746368006E
0060: 4E525F4465746169 6C006E49646D696E 4974656D4E72006E 4C6F636B5F494400
0080: 6E45696E72696368 744964006E566972 7446616C6C4B6579 006E4E65774C7374
00A0: 4572664E72006E4C 5400735661727300 004442475F504C41 594241434B5F4755
00C0: 494400100075EB38 08F8FB3840AB751D CFB4CC1A51005761 746368566172734C
00E0: 656E000400A40000 0000000000000000
.enddata
.head 1 -  Outline Version - 4.0.35
.head 1 +  Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000FB0000 002C000000020000 0003000000FFFFFF FFFFFFFFFFFCFFFF
0040: FFE9FFFFFF000000 0000000000190300 00C4010000010000 0001000000010000
0060: 000F4170706C6963 6174696F6E497465 6D0100000012496E 7465726E616C2046
0080: 756E6374696F6E73
.enddata
.data DT_MAKERUNDLG
0000: 0900001002000000 0012573A5C64796E 615F657870666E63 2E65786512573A5C
0020: 64796E615F657870 666E632E646C6C12 573A5C64796E615F 657870666E632E61
0040: 7063000001010100 6400000012573A5C 64796E615F657870 666E632E72756E12
0060: 573A5C64796E615F 657870666E632E64 6C6C12573A5C6479 6E615F657870666E
0080: 632E617063000001 010100640000000F 64796E615F4C545F 666E632E6170640F
00A0: 64796E615F657870 666E632E646C6C0F 64796E615F657870 666E632E61706300
00C0: 0001010100640000 0012573A5C64796E 615F657870666E63 2E61706C12573A5C
00E0: 64796E615F657870 666E632E646C6C12 573A5C64796E615F 657870666E632E61
0100: 7063000001010100 6400000000000000 0001010100640000 0000000000000101
0120: 0100640000000000 0000000101010064 0000000000000000 0000000000000000
0140: 0000000000000000 0000000000010000 0001000000010001 0000000000000000
0160: 0100001000000000 0000000000000000
.enddata
.head 2 -  Outline Window State: Maximized
.head 2 +  Outline Window Location and Size
.data VIEWINFO
0000: 6600060003001B00 0200000000000000 00003A1EC2120500 1D00FFFF4D61696E
0020: 0022000100020066 02000000003A1EE6 1300000200FFFF74 626C426577656775
0040: 6E67002000000004 001C001301E50064 195D0E0000DF00FF FF5661726961626C
0060: 6573002900010004 006102000000003A 1E071200008600FF FF496E7465726E61
0080: 6C2046756E637469 6F6E73001E000100 0400630200000000 3A1E07120000F400
00A0: FFFF436C61737365 73001F0001000000 0000000000003A1E 071200000101FFFF
00C0: 636C73436F6C4241 00
.enddata
.data VIEWSIZE
0000: C900
.enddata
.head 3 -  Left: -0.025"
.head 3 -  Top: 0.0"
.head 3 -  Width:  8.013"
.head 3 -  Height: 4.969"
.head 2 +  Options Box Location
.data VIEWINFO
0000: C4385A08B80B2A00
.enddata
.data VIEWSIZE
0000: 0800
.enddata
.head 3 -  Visible? Yes
.head 3 -  Left: 4.15"
.head 3 -  Top: 1.885"
.head 3 -  Width:  3.8"
.head 3 -  Height: 2.073"
.head 2 +  Class Editor Location
.head 3 -  Visible? No
.head 3 -  Left: 2.263"
.head 3 -  Top: 0.177"
.head 3 -  Width:  5.063"
.head 3 -  Height: 2.719"
.head 2 +  Tool Palette Location
.head 3 -  Visible? No
.head 3 -  Left: 5.425"
.head 3 -  Top: 0.865"
.head 2 -  Fully Qualified External References? Yes
.head 2 -  Reject Multiple Window Instances? Yes
.head 2 -  Enable Runtime Checks Of External References? Yes
.head 2 -  Use Release 4.0 Scope Rules? No
.head 2 -  Edit Fields Read Only On Disable? No
.head 1 +  Libraries
.head 2 -  !
.head 2 -  Dynalib: Dyna_Vars_INI.apd
.head 2 -  Dynalib: Dyna_Vars_Gnrl.apd
.head 2 -  Dynalib: Dyna_Vars_GHS.apd
.head 2 -  Dynalib: Dyna_Vars_Tmp.apd
.head 2 -  !
.head 2 -  Dynalib: dyna_multidb.apd
.head 2 -  File Include: remark.apl
.head 2 -  File Include: modul.apl
.head 2 -  File Include: cls_clmn.apl
.head 2 -  File Include: hasharr.apl
.head 2 -  File Include: mainacts.apl
.head 2 -  File Include: mtbl_cut.apl
.head 2 -  File Include: BarCode_Func.apl
.head 2 -  File Include: cls_sortfilterdlg.apl
.head 2 -  Dynalib: ExcelExport.apd
.head 2 -  Dynalib: dyna_routine.apd
.head 2 -  ! Dynalib: dyna_expfnc.apd
.head 2 -  ! Dynalib: dyna_misc.apd
.head 2 -  ! Dynalib: dyna_versionFnc.apd
.head 2 -  ! Dynalib: dyna_profile.apd
.head 2 -  !
.head 2 -  ! File Include: fall_groups_cls.apl
.head 2 -  ! File Include: vtarray.apl
.head 2 -  ! File Include: sqlhandl.apl
.head 2 -  ! File Include: vtmisc.apl
.head 2 -  ! File Include: cls_tabl_editgnrl.apl
.head 2 -  File Include: cls_Tabl_Brws.APL
.head 2 -  Dynalib: Dyna_InitFnc.apd
.head 2 -  File Include: Gtablex.apl
.head 1 +  Global Declarations
.head 2 +  Window Defaults
.head 3 +  Tool Bar
.head 4 -  Display Style? Etched
.head 4 -  Font Name: System Default
.head 4 -  Font Size: System Default
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Form Window
.head 4 -  Display Style? Etched
.head 4 -  Font Name: System Default
.head 4 -  Font Size: System Default
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Dialog Box
.head 4 -  Display Style? Etched
.head 4 -  Font Name: System Default
.head 4 -  Font Size: System Default
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Top Level Table Window
.head 4 -  Font Name: System Default
.head 4 -  Font Size: System Default
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Data Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Multiline Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Spin Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Background Text
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Pushbutton
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Radio Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Check Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Option Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Group Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Child Table Window
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  List Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Combo Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Line
.head 4 -  Line Color: Use Parent
.head 3 +  Frame
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Picture
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 2 +  Formats
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: ###000
.head 3 -  Number: ###000;'($'###000')'
.head 3 -  Number: 0000
.head 3 -  Date/Time: M/d/yy
.head 3 -  Date/Time: MM-dd-yy
.head 3 -  Date/Time: MMM d, yyyy
.head 3 -  Date/Time: MMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MMMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: dd-MMM-yyyy hh:mm
.head 3 -  Date/Time: dd-MMM-yyyy
.head 3 -  Date/Time: dd-MM-yyyy hh:mm
.head 3 -  Date/Time: dd.MM.yyyy hhhh:mm:ss
.head 3 -  Date/Time: dd-MM-yyyy hh:mm AMPM
.head 3 -  Date/Time: dd-MM-yyyy hhhh:mm
.head 3 -  Date/Time: dd.MM.yyyy hhhh:mm
.head 3 -  Date/Time: dd.MM.yyyy
.head 3 -  Date/Time: dd.MM.yy
.head 3 -  Date/Time: hh:mm:ss AMPM
.head 3 -  Date/Time: hh:mm
.head 3 -  Input: MMM d, yyyy hh:mm AMPM
.head 3 -  Input: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
.head 3 -  Input: 99-99-9999 99:99
.head 3 -  Input: 99-99-9999 99:99 AMPM
.head 3 -  Input: 99.99.9999 99:99:99
.head 3 -  Input: 99.99.9999
.head 3 -  Input: 99.99.99
.head 3 -  Input: 99:99
.head 3 -  Input: 9
.head 3 -  Input: 99
.head 3 -  Input: 999
.head 3 -  Input: 9999
.head 3 -  Input: 99999
.head 3 -  Input: 999999
.head 3 -  Input: 9999999
.head 3 -  Input: 99999999
.head 3 -  Input: 999999999999
.head 3 -  Input: 999999999999999
.head 2 +  External Functions
.head 2 +  Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
.head 3 +  System
.head 3 +  User
.head 3 -  Enumerations
.head 2 +  Resources
.head 2 +  Variables
.head 3 -  String: sScreen
.head 3 -  String: sTmpTransaction
.head 3 -  Window Handle: hWndViewLT
.head 3 -  Window Handle: hWndUndoInfo
.head 2 +  Internal Functions
.head 3 -  ! -----------------------------------------------------------------------------------------------------------------------
.head 3 -  ! ----------=========={{{{{{{{{{ LOGICAL TRANSACTION }}}}}}}}}}}===========----------
.head 3 -  ! -----------------------------------------------------------------------------------------------------------------------
.head 3 -  ! manage done status
.head 3 +  Function: LT_OpenTransaction		! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Number: nType
.head 5 -  Date/Time: dtStart
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 5 -  Number: nNr
.head 4 +  Actions
.head 5 +  If Not SqlConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "update LT set status=3, END=@now where user_id=:nUserId and type=0 " )
.head 5 +  If CheckDBVersion( 9.74 ) and bLimitKey
.head 6 -  Set sTmpTransaction = sLogicalChain
.head 6 -  Set sLogicalChain = "LOGICAL TRANSACTION"
.head 6 -  Set nNr = SalStrToNumber( GetNewKey( "LT", "NR" ) )
.head 6 +  If nNr=0
.head 7 -  Set bOk= FALSE
.head 6 -  Set bOk = bOk and SqlPrepareAndExecute( hSql, "
Insert into LT (NR,USER_ID, TYPE, STATUS, START) values(:nNr,:nUserId,:nType,0,:dtStart) " )
.head 5 +  If CheckDBVersion( 9.71 ) and not bLimitKey
.head 6 -  Set bOk = bOk and SqlPrepareAndExecute( hSql, "
Insert into LT (USER_ID, TYPE, STATUS, START) values(:nUserId,:nType,0,:dtStart)
" )
.head 5 +  Else If not bLimitKey
.head 6 -  Set bOk = bOk and SqlPrepareAndExecute( hSql, "
Insert into LT (NR,USER_ID, TYPE, STATUS, START) select MAX(NR)+1,:nUserId,:nType,0,:dtStart from lt
" )
.head 5 +  If CheckDBVersion( 9.74 ) and bLimitKey
.head 6 -  Set sLogicalChain=sTmpTransaction
.head 6 -  Set sTmpTransaction=""
.head 5 +  If bOk
.head 6 -  Set bOk = SqlPrepareAndExecute( hSql, "commit")
.head 5 +  Else
.head 6 -  Set bOk = SqlPrepareAndExecute( hSql, "rollback")
.head 5 +  If hSql
.head 6 -  Call SqlDisconnect( hSql )
.head 5 -  Return bOk
.head 3 +  Function: LT_CloseLastTransaction		! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 5 -  Number: nNr
.head 4 +  Actions
.head 5 -  ! Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	NR 
from	LT
where	USER_ID = :nUserId
and 	STATUS=0
into	:nNr
" )
.head 5 -  Set bOk = bOk And SqlFetchNext( hSql, nFetch )
.head 5 -  Set bOk = SqlDisconnect( hSql ) And bOk
.head 5 +  If not LT_CloseTransaction(nNr,SalDateCurrent())
.head 6 -  Return FALSE
.head 5 -  Return bOk
.head 3 +  Function: LT_GetNumOfNewTransaction	! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Sql Handle: hSql_LT
.head 5 -  Boolean: bOk
.head 5 -  Number: nLT
.head 5 -  Number: nFtch
.head 5 -  Number: nCounter
.head 5 -  Number: nCountUpdated
.head 4 +  Actions
.head 5 +  If Not GalConnect( hSql_LT )
.head 6 -  Return 0
.head 5 -  Set nCounter = 5
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql_LT, "
select       max(ID)
from          UNIQUE_ID
where       DESCRIPTION='LT'
into	 :nLT " )
.head 5 -  Set bOk = bOk And SqlFetchNext( hSql_LT, nFtch )
.head 5 +  If bOk
.head 6 +  Loop
.head 7 -  Set bOk = bOk And SqlPrepareAndExecute( hSql_LT, "
Update 	UNIQUE_ID
set 	ID = 1+:nLT
where 	DESCRIPTION = 'LT'   and  ID = :nLT " )
.head 7 -  Set bOk = bOk And  SqlGetModifiedRows ( hSql_LT, nCountUpdated)
.head 7 -  Set nCounter = nCounter - 1
.head 7 +  If nCountUpdated>0 or nCounter = 0
.head 8 -  Break
.head 5 +  If bOk and nCountUpdated>0
.head 6 -  Set bOk = SqlPrepareAndExecute( hSql_LT, "commit")
.head 6 -  Set nLT = nLT+1
.head 5 +  Else
.head 6 -  Set bOk = SqlPrepareAndExecute( hSql_LT, "rollback")
.head 6 -  Call SalMessageBox ( "System could not generate LT ID. Please try later.", "Warning", MB_Ok )
.head 6 -  Set nLT = 0
.head 5 -  Call SqlDisconnect( hSql_LT)
.head 5 -  Return nLT
.head 3 +  Function: LT_AddRecordToLT_Detail		! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nLT
.head 5 -  String: sTableName
.head 5 -  String: sAction
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Number: nNR
.head 5 -  Number: nFtch
.head 5 -  Number: nNR_Detail
.head 4 +  Actions
.head 5 -  Set bOk = TRUE
.head 5 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql, "
select 	@nullvalue(max(NR)+1,1)
from 	LT_DETAIL
where 	LT_NR=:nLT into :nNR " )
.head 5 -  Set bOk = bOk and SqlFetchNext( hSql, nFtch )
.head 5 -  Set bOk = bOk And SqlPrepareAndExecute( hSql, "
insert 	into LT_DETAIL (LT_NR, NR, OP, TBNAME)
values 	(:nLT,:nNR, :sAction, :sTableName ) " )
.head 5 -  Set bOk = bOk And SqlPrepareAndExecute( hSql, "
select 	ID
from 	LT_DETAIL
where 	LT_NR=:nLT and NR=:nNR and OP= :sAction
into	:nNR_Detail " )
.head 5 -  Set bOk = bOk and SqlFetchNext( hSql, nFtch )
.head 5 +  If Not bOk 
.head 6 -  Set nNR_Detail = 0
.head 5 -  Return nNR_Detail
.head 3 +  Function: LT_RollbackLastTransaction		! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 5 -  Number: nNr
.head 4 +  Actions
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	NR 
from	LT
where	USER_ID = :nUserId
and 	STATUS=0
order by nr descr
into	:nNr
" )
.head 5 -  Set bOk = bOk And SqlFetchNext( hSql, nFetch )
.head 5 -  Set bOk = bOk And SqlPrepareAndExecute( hSql, "delete from lt where nr=:nNr " )
.head 5 +  If bOk
.head 6 -  Call SqlPrepareAndExecute( hSql, "commit")
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( hSql, "rollback")
.head 5 +  If hSql
.head 6 -  Call SqlDisconnect( hSql )
.head 5 -  Return bOk
.head 3 +  Function: CanLT_Clear 			! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bEx
.head 4 +  Actions
.head 5 -  Call SqlExists( "Select * from lt", bEx )
.head 5 -  Return bEx
.head 3 +  Function: LT_ClearAll			! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 4 +  Actions
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select * from activitylog
where logged_out is null
and appname != 'Sys_verw.exe'
order by id desc
" )
.head 5 +  If bOk
.head 6 +  If SqlFetchNext( hSql, nFetch )
.head 7 -  Call GalMessageBox( D_GetMessageStatic(10009) , D_GetMessageStatic(11080), MB_Ok)
.head 7 -  Set bOk = FALSE
.head 6 +  Else
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute( hSql, "Delete from lt" )
.head 7 -  ! Set bOk = bOk and SqlPrepareAndExecute( hSql, "
Insert into LT (NR,USER_ID, TYPE, STATUS, START,END) values(1,-1,-1,1,@now,@now) " )
.head 7 +  If bOk 
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute( hSql, "commit" )
.head 8 -  Call GalMessageBox( D_GetMessageStatic(10019) , D_GetMessageStatic(11081), MB_Ok)
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( hSql, "rollback" )
.head 5 +  If hSql
.head 6 -  Call SqlDisconnect( hSql )
.head 5 -  Return bOk
.head 3 +  Function: LT_CloseAndUndoLastTransaction	! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 5 -  Number: nNr
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	NR 
from	LT
where	USER_ID = :nUserId
and 	STATUS=0
into	:nNr
" )
.head 5 -  Set bOk = bOk And SqlFetchNext( hSql, nFetch )
.head 5 -  Set bOk = SqlDisconnect( hSql ) And bOk
.head 5 +  If not LT_CloseTransaction(nNr,SalDateCurrent())
.head 6 -  Return FALSE
.head 5 -  Call LT_Undo(nNr,FALSE)
.head 5 -  Return bOk
.head 3 +  Function: LT_CloseTransaction		! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nNR
.head 5 -  Date/Time: dtEnd
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 4 +  Actions
.head 5 -  ! Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
Update	LT
Set STATUS=1,
END=:dtEnd
where	NR=:nNR
" )
.head 5 +  If bOk
.head 6 -  Set bOk = SqlPrepareAndExecute( hSql, "commit")
.head 5 -  Set bOk = SqlDisconnect( hSql ) And bOk
.head 5 -  Return bOk
.head 3 +  Function: LT_SetOpenToCheck		! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
Update	LT
Set STATUS=2
where	USER_ID = :nUserId
and STATUS=0
" )
.head 5 +  If bOk
.head 6 -  Set bOk = SqlPrepareAndExecute( hSql, "commit")
.head 5 -  Set bOk = SqlDisconnect( hSql ) And bOk
.head 5 -  Return bOk
.head 3 +  Function: LT_UndoLast			! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nNr
.head 5 -  Number: nFetch
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 -  Call LT_SetOpenToCheck()	
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	MAX(NR) 
from	LT
where	USER_ID = :nUserId
and 	STATUS=1
and  not exists(Select l.nr from LT l where (l.status = 0) and l.USER_ID = :nUserId)
into	:nNr
" )
.head 5 -  Set bOk = bOk And SqlFetchNext( hSql, nFetch )
.head 5 -  Set bOk = SqlDisconnect( hSql ) And bOk
.head 5 +  If not LT_Undo(nNr,TRUE)
.head 6 -  Return FALSE
.head 5 -  Return bOk
.head 3 +  Function: LT_UndoLastForCage		! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sStatKey
.head 5 -  String: sGruppeKey
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nNr
.head 5 -  Number: nFetch
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	MAX(NR) 
from	LT
where	USER_ID = :nUserId
and 	STATUS=1
and  not exists(Select l.nr from LT l where (l.status = 0 or l.status=2) and l.USER_ID = :nUserId)
into	:nNr
" )
.head 5 -  Set bOk = bOk And SqlFetchNext( hSql, nFetch )
.head 5 -  Set bOk = SqlDisconnect( hSql ) And bOk
.head 5 +  If not LT_Undo(nNr,TRUE)
.head 6 -  Return FALSE
.head 5 -  Return bOk
.head 3 +  Function: LT_Undo				! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nNr
.head 5 -  Boolean: bAsk
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Sql Handle: h1Sql
.head 5 -  Number: nFetch
.head 5 -  Number: nFetch1
.head 5 -  Number: nRs_Id
.head 5 -  Number: nType
.head 5 -  Number: nFall
.head 5 -  Number: nT1
.head 5 -  Number: nT2
.head 5 -  Number: nStatus
.head 5 -  Date/Time: dtStart
.head 5 -  String: sStart
.head 5 -  String: sT1
.head 5 -  String: sT2
.head 5 -  String: sT3
.head 5 -  String: sM
.head 5 -  String: sBach
.head 5 -  String: sStrain
.head 5 -  String: sSex
.head 5 -  Number: nLastLT
.head 5 -  Window Handle: hWndWait
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 +  If Not GalConnect( h1Sql)
.head 6 -  Call SqlDisconnect( hSql)
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, " select max(nr) from lt where status <3 into :nLastLT " )
.head 5 -  Set bOk = bOk and SqlFetchNext(hSql, nFetch)
.head 5 +  If nLastLT != nNr 
.head 6 -  Call SalMessageBox( "Last operation was performed by another user.", "Error", MB_Ok )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	STATUS, TYPE,Start
from	LT
where	NR=:nNr
  into	:nStatus,:nType,:dtStart
" )
.head 5 -  Set bOk = bOk And SqlFetchNext( hSql, nFetch )
.head 5 -  Call SalDateToStr( dtStart, sStart )
.head 5 +  Select Case nType
.head 6 +  Case 1
.head 7 -  Set sM="Do you want to undo mating that was created "||sStart||"?:"
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	distinct rf.relship_id , r.rs_stat_key, r.rs_gruppe_key, r.family_name
from	relship_fall rf, lt_fall lf, lt l, relationship r
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=rf.fall_key
and 	rf.fallrolle_key='MATE'
and 	rf.rs_fall_start>=l.start
and 	rf.relship_id=r.relship_id
  into	:nRs_Id, :sT1, :sT2, :sT3" )
.head 7 -  Set nFetch=0
.head 7 +  While SqlFetchNext( hSql, nFetch )
.head 8 -  Set nFetch1=0
.head 8 -  Set sM=sM||'

Rack: '||sT1||'     Cage: '||sT2||'         Family Name:  '||sT3
.head 8 -  Set bOk = SqlPrepareAndExecute( h1Sql, "
select	rf.fall_key, g. geschl_Abr,  f.geb_datum, f.name3
from	relship_fall rf, lt_fall lf, lt l, fall f, relationship r, geschlecht g
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=rf.fall_key
and 	rf.fallrolle_key='MATE'
and 	rf.rs_fall_start>=l.start
and 	rf.relship_id=r.relship_id
and 	rf.relship_id=:nRs_Id
and 	f.fall_key=rf.fall_Key
and 	f.geschl=g.geschl_Key
  into	:nFall, :sSex, :sBach, :sStrain" )
.head 8 +  While SqlFetchNext( h1Sql, nFetch1 )
.head 9 -  Set sM=sM||'
         '||SalNumberToStrX(nFall,0)||'     '||sSex||'          '||sStrain||'      '||sBach
.head 7 +  If bAsk
.head 8 +  If not IDYES = SalMessageBox( sM, "UNDO_MATING", MB_IconQuestion | MB_YesNo  )
.head 9 -  Set bOk=FALSE
.head 9 -  Break
.head 7 -  Set hWndWait = SalCreateWindow( dlgWait, hWndNULL )
.head 7 +  If not LockSysadmAction("Undo")
.head 8 -  Set bOk=FALSE
.head 8 -  Break
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	distinct rf.relship_id 
from	relship_fall rf, lt_fall lf, lt l
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=rf.fall_key
and 	rf.fallrolle_key='MATE'
and 	rf.rs_fall_start>=l.start
  into	:nRs_Id" )
.head 7 -  Set nFetch=0
.head 7 +  While SqlFetchNext( hSql, nFetch )
.head 8 -  Set bOk = SqlPrepareAndExecute( h1Sql, "
delete	
from	relship_fall
where	relship_id=:nRs_Id" )
.head 8 -  Set bOk = SqlPrepareAndExecute( h1Sql, "
delete	
from	relationship
where	relship_id=:nRs_Id" )
.head 8 -  Set bOk = SqlPrepareAndExecute( h1Sql, "commit" )
.head 7 -  Call LT_DeleteBew(nNr)
.head 7 -  Call LT_SetToUndo(nNr)
.head 7 -  Break
.head 6 +  Case 2
.head 7 -  Set sM="Do you want to undo discharge that was done "||sStart||"?"
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	distinct b.stat_key, b.Gruppe_key
from	BEwegung b, lt_fall lf, lt l
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	b.ba_key='EE'
  into	:sT1, :sT2" )
.head 7 -  Set nFetch=0
.head 7 +  While SqlFetchNext( hSql, nFetch )
.head 8 -  Set sM=sM||'

In Rack: '||sT1||'     Cage: '||sT2
.head 8 -  Set nFetch1=0
.head 8 -  Set bOk = SqlPrepareAndExecute( h1Sql, "
select	lf.fall_key, g. geschl_Abr,  f.geb_datum, f.name3
from	BEwegung b, lt_fall lf, lt l, fall f, geschlecht g
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	b.ba_key='EE'
and 	b.fall_key=f.fall_Key
and 	f.geschl=g.geschl_key
  into	:nFall, :sSex, :sBach, :sStrain" )
.head 8 +  While SqlFetchNext( h1Sql, nFetch1 )
.head 9 -  Set sM=sM||'
         '||SalNumberToStrX(nFall,0)||'     '||sSex||'          '||sStrain||'      '||sBach
.head 7 +  If bAsk
.head 8 +  If not IDYES = SalMessageBox( sM, "UNDO_DISCHARGE", MB_IconQuestion | MB_YesNo  )
.head 9 -  Set bOk=FALSE
.head 9 -  Break
.head 7 -  Set hWndWait = SalCreateWindow( dlgWait, hWndNULL )
.head 7 +  If not LockSysadmAction("Undo")
.head 8 -  Set bOk=FALSE
.head 8 -  Break
.head 7 -  Call LT_DeleteBew(nNr)
.head 7 -  Call LT_DeleteCulling(nNr)
.head 7 -  Call LT_SetToUndo(nNr)
.head 7 -  Break
.head 6 +  Case 3
.head 7 -  Set sM="Do you want to undo IMPORT that was done "||sStart||"?"
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	distinct b.stat_key, b.Gruppe_key
from	BEwegung b, lt_fall lf, lt l
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	b.ba_key='AE'
  into	:sT1, :sT2" )
.head 7 -  Set nFetch=0
.head 7 +  While SqlFetchNext( hSql, nFetch )
.head 8 -  Set sM=sM||'

In Rack: '||sT1||'     Cage: '||sT2
.head 8 -  Set nFetch1=0
.head 8 -  Set bOk = SqlPrepareAndExecute( h1Sql, "
select	lf.fall_key, g. geschl_Abr,  f.geb_datum, f.name3
from	BEwegung b, lt_fall lf, lt l, fall f, geschlecht g
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	b.ba_key='AE'
and 	b.fall_key=f.fall_Key
and 	b.stat_key=:sT1
and 	b.gruppe_key=:sT2
and 	f.geschl=g.geschl_key
and 	lf.bew_nr is null
  into	:nFall, :sSex, :sBach, :sStrain" )
.head 8 +  While SqlFetchNext( h1Sql, nFetch1 )
.head 9 -  Set sM=sM||'
         '||SalNumberToStrX(nFall,0)||'     '||sSex||'          '||sStrain||'      '||sBach
.head 7 +  If bAsk
.head 8 +  If not IDYES = SalMessageBox( sM, "UNDO_IMPORT", MB_IconQuestion | MB_YesNo  )
.head 9 -  Set bOk=FALSE
.head 9 -  Return FALSE
.head 7 -  Set hWndWait = SalCreateWindow( dlgWait, hWndNULL )
.head 7 +  If not LockSysadmAction("Undo")
.head 8 -  Set bOk=FALSE
.head 8 -  Break
.head 7 -  Call LT_DeleteBew(nNr)
.head 7 -  Call LT_DeleteFall(nNr)
.head 7 -  Call LT_SetToUndo(nNr)
.head 7 -  Break
.head 6 +  Case 4
.head 7 -  Set sM="Do you want to undo WEANING that was done "||sStart||"?"
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	distinct b.stat_key, b.Gruppe_key
from	BEwegung b, lt_fall lf, lt l
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	b.ba_key='AE'
  into	:sT1, :sT2" )
.head 7 -  Set nFetch=0
.head 7 +  While SqlFetchNext( hSql, nFetch )
.head 8 -  Set sM=sM||'

In Rack: '||sT1||'     Cage: '||sT2
.head 8 -  Set nFetch1=0
.head 8 -  Set bOk = SqlPrepareAndExecute( h1Sql, "
select	lf.fall_key, g. geschl_Abr,  f.geb_datum, f.name3
from	BEwegung b, lt_fall lf, lt l, fall f, geschlecht g
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	b.ba_key='AE'
and 	b.fall_key=f.fall_Key
and 	b.stat_key=:sT1
and 	b.gruppe_key=:sT2
and 	f.geschl=g.geschl_key
and 	lf.bew_nr is null
  into	:nFall, :sSex, :sBach, :sStrain" )
.head 8 +  While SqlFetchNext( h1Sql, nFetch1 )
.head 9 -  Set sM=sM||'
         '||SalNumberToStrX(nFall,0)||'     '||sSex||'          '||sStrain||'      '||sBach
.head 7 +  If bAsk
.head 8 +  If not IDYES = SalMessageBox( sM, "WEANING", MB_IconQuestion | MB_YesNo  )
.head 9 -  Set bOk=FALSE
.head 9 -  Break
.head 7 -  Set hWndWait = SalCreateWindow( dlgWait, hWndNULL )
.head 7 +  If not LockSysadmAction("Undo")
.head 8 -  Set bOk=FALSE
.head 8 -  Break
.head 7 -  Call LT_DeleteBew(nNr)
.head 7 -  Call LT_DeleteFall(nNr)
.head 7 -  Call LT_SetToUndo(nNr)
.head 7 -  Break
.head 6 +  Case 5
.head 7 -  Set sM="Do you want to undo MOVE that was done "||sStart||"?"
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	distinct b.stat_key, b.Gruppe_key, b2.gruppe_key
from	BEwegung b, lt_fall lf, lt l, bewegung b2
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	lf.fall_Key=b2.fall_key
and 	b.bew_nr=lf.bew_nr-1
and 	b2.bew_nr=lf.bew_nr
  into	:sT1, :sT2, :sT3" )
.head 7 -  Set nFetch=0
.head 7 +  While SqlFetchNext( hSql, nFetch )
.head 8 -  Set sM=sM||'

From: '||sT1||'     to cage: '||sT3
.head 7 +  If bAsk
.head 8 +  If not IDYES = SalMessageBox( sM, "UNDO_MOVE", MB_IconQuestion | MB_YesNo  )
.head 9 -  Set bOk=FALSE
.head 9 -  Break
.head 7 -  Set hWndWait = SalCreateWindow( dlgWait, hWndNULL )
.head 7 +  If not LockSysadmAction("Undo")
.head 8 -  Set bOk=FALSE
.head 8 -  Break
.head 7 -  Call LT_DeleteBew(nNr)
.head 7 -  Call LT_SetToUndo(nNr)
.head 7 -  Break
.head 6 +  Case 6
.head 7 -  Set sM="Do you want to undo MOVE that was done "||sStart||"?"
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	distinct b.stat_key, b.Gruppe_key, b2.gruppe_key
from	BEwegung b, lt_fall lf, lt l, bewegung b2
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	lf.fall_Key=b2.fall_key
and 	b.bew_nr=lf.bew_nr-1
and 	b2.bew_nr=lf.bew_nr
  into	:sT1, :sT2, :sT3" )
.head 7 -  Set nFetch=0
.head 7 +  While SqlFetchNext( hSql, nFetch )
.head 8 -  Set sM=sM||'

From: '||sT1||'     to cage: '||sT3
.head 7 +  If bAsk
.head 8 +  If not IDYES = SalMessageBox( sM, "UNDO_MOVE", MB_IconQuestion | MB_YesNo  )
.head 9 -  Set bOk=FALSE
.head 9 -  Break
.head 7 -  Set hWndWait = SalCreateWindow( dlgWait, hWndNULL )
.head 7 +  If not LockSysadmAction("Undo")
.head 8 -  Set bOk=FALSE
.head 8 -  Break
.head 7 -  Call LT_DeleteBew(nNr)
.head 7 -  Call LT_SetToUndo(nNr)
.head 7 -  Break
.head 6 +  Case 7
.head 7 -  Set sM="Do you want to undo MOVE that was done "||sStart||"?"
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	distinct b.stat_key, b.Gruppe_key, b2.gruppe_key
from	BEwegung b, lt_fall lf, lt l, bewegung b2
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	lf.fall_Key=b2.fall_key
and 	b.bew_nr=lf.bew_nr-1
and 	b2.bew_nr=lf.bew_nr
  into	:sT1, :sT2, :sT3" )
.head 7 -  Set nFetch=0
.head 7 +  While SqlFetchNext( hSql, nFetch )
.head 8 -  Set sM=sM||'
From: '||sT1||'     to cage: '||sT3
.head 7 +  If bAsk
.head 8 +  If not IDYES = SalMessageBox( sM, "UNDO_MOVE", MB_IconQuestion | MB_YesNo  )
.head 9 -  Set bOk=FALSE
.head 9 -  Break
.head 7 -  Set hWndWait = SalCreateWindow( dlgWait, hWndNULL )
.head 7 +  If not LockSysadmAction("Undo")
.head 8 -  Set bOk=FALSE
.head 8 -  Break
.head 7 -  Call LT_DeleteBew(nNr)
.head 7 -  Call LT_SetToUndo(nNr)
.head 7 -  Break
.head 6 +  Case 8
.head 7 -  Set sM="Do you want to undo litter that was done "||sStart||"?"
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	rm.family_name, rl.relship_id, l.litter_id
from	lt_fall lf, lt l, relationship rm, relationship rl, litter l
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.litter_id=l.litter_id
and 	l.place_relship_id=rm.relship_id
and 	l.family_relship_id=rl.relship_id
into	:sT1, :nT1, :nT2" )
.head 7 -  Set nFetch=0
.head 7 +  If SqlFetchNext( hSql, nFetch )
.head 8 -  Set sM=sM||'
litter: '||SalNumberToStrX(nT2,0)||'    in  family: '||sT1
.head 8 +  If bAsk
.head 9 +  If not IDYES = SalMessageBox( sM, "UNDO_LITTER", MB_IconQuestion | MB_YesNo  )
.head 10 -  Set bOk=FALSE
.head 10 -  Break
.head 8 -  Set hWndWait = SalCreateWindow( dlgWait, hWndNULL )
.head 8 +  If not LockSysadmAction("Undo")
.head 9 -  Set bOk=FALSE
.head 9 -  Break
.head 8 -  Call SqlPrepareAndExecute(hSql,"delete from litter_child where litter_id=:nT2")
.head 8 -  Call SqlPrepareAndExecute(hSql,"delete from litter where litter_id=:nT2")
.head 8 -  Call SqlPrepareAndExecute(hSql,"delete from relship_Fall where relship_id=:nT1")
.head 8 -  Call SqlPrepareAndExecute(hSql,"delete from relationship where relship_id=:nT1")
.head 8 -  Call SqlPrepareAndExecute(hSql,"commit")
.head 7 -  Call LT_SetToUndo(nNr)
.head 7 -  Break
.head 6 +  Case 9
.head 7 -  Set sM="Do you want to undo IMPORT that was done "||sStart||"?"
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	distinct b.stat_key, b.Gruppe_key
from	BEwegung b, lt_fall lf, lt l
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	b.ba_key='AE'
  into	:sT1, :sT2" )
.head 7 -  Set nFetch=0
.head 7 +  While SqlFetchNext( hSql, nFetch )
.head 8 -  Set sM=sM||'

In Rack: '||sT1||'     Cage: '||sT2
.head 8 -  Set nFetch1=0
.head 8 -  Set bOk = SqlPrepareAndExecute( h1Sql, "
select	lf.fall_key, g. geschl_Abr,  f.geb_datum, f.name3
from	BEwegung b, lt_fall lf, lt l, fall f, geschlecht g
where	l.NR=:nNr
and 	lf.NR=:nNr
and 	lf.fall_Key=b.fall_key
and 	b.ba_key='AE'
and 	b.fall_key=f.fall_Key
and 	b.stat_key=:sT1
and 	b.gruppe_key=:sT2
and 	f.geschl=g.geschl_key
and 	lf.bew_nr is null
  into	:nFall, :sSex, :sBach, :sStrain" )
.head 8 +  While SqlFetchNext( h1Sql, nFetch1 )
.head 9 -  Set sM=sM||'
         '||SalNumberToStrX(nFall,0)||'     '||sSex||'          '||sStrain||'      '||sBach
.head 7 +  If bAsk
.head 8 +  If not IDYES = SalMessageBox( sM, "UNDO_IMPORT", MB_IconQuestion | MB_YesNo  )
.head 9 -  Set bOk=FALSE
.head 9 -  Return FALSE
.head 7 -  Set hWndWait = SalCreateWindow( dlgWait, hWndNULL )
.head 7 +  If not LockSysadmAction("Undo")
.head 8 -  Set bOk=FALSE
.head 8 -  Break
.head 7 -  Call LT_DeleteBew(nNr)
.head 7 -  Call LT_DeleteFall(nNr)
.head 7 -  Call LT_SetToUndo(nNr)
.head 7 -  Set bOk = SqlPrepareAndExecute( h1Sql, "
update	gruppe
set RFID=Null
where	stat_key=:sT1
and 	gruppe_key=:sT2
" )
.head 7 -  Set bOk = SqlPrepareAndExecute( h1Sql, "commit" )
.head 7 -  Break
.head 6 +  Case 10
.head 7 +  If bAsk
.head 8 +  If not IDYES = SalMessageBox( "Do you want to undo Plan Mating?", "UNDO Plan Mating", MB_IconQuestion | MB_YesNo  )
.head 9 -  Set bOk=FALSE
.head 9 -  Return FALSE
.head 7 -  Call LT_UndoPlanMating(nNr)
.head 7 -  Break
.head 6 +  Default
.head 7 -  Break
.head 5 +  If hWndWait
.head 6 -  Call SalDestroyWindow(hWndWait )
.head 5 -  Call ReleaseSysadmAction(TRUE)
.head 5 -  Set bOk = SqlDisconnect( hSql ) And bOk
.head 5 -  Call SqlDisconnect( h1Sql)
.head 5 -  Return bOk
.head 3 +  Function: LT_UndoPlanMating
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nLT
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Sql Handle: hSql1
.head 5 -  Number: nFtch
.head 5 -  Number: nFtch1
.head 5 -  Number: nNR_Detail
.head 5 -  String: sStorn
.head 5 -  Number: nEinrichtId
.head 5 -  Number: nVirtFallKey
.head 5 -  Number: nNewLstErfNr
.head 5 -  Number: nIdminItemNr
.head 5 -  Date/Time: dt_BewZeit_Old 
.head 5 -  Number: nLock_ID
.head 5 -  Number: nLastBewNr
.head 5 -  Number: nNewLstErf
.head 5 -  Number: nFallKey
.head 4 +  Actions
.head 5 +  If Not SqlConnect( hSql )
.head 6 -  Return FALSE
.head 5 +  If Not SqlConnect( hSql1 )
.head 6 -  Return FALSE
.head 5 -  ! revert command "Update LST_ERF"
.head 5 -  Set bOk =SqlPrepareAndExecute( hSql, "
select 	ID
from 	LT_DETAIL
where 	LT_NR=:nLT 
and 	OP = 'U'
and 	TBNAME = 'LST_ERF'
into 	:nNR_Detail " )
.head 5 +  While SqlFetchNext( hSql, nFtch )
.head 6 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql1, "
select 	VALS, KEY1, KEY2, ,KEY3
from 	LT_VALUES
where 	ID = :nNR_Detail
into	:sStorn,  :nEinrichtId,  :nVirtFallKey, :nNewLstErfNr " )
.head 6 -  Call SqlFetchNext( hSql1, nFtch1 )
.head 6 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1,"
	Update 	LST_ERF
	set 	STORNIERT = :sStorn
	where 	LST_ERF_NR = :nNewLstErfNr
	and 	EINRICHT_ID = :nEinrichtId
	and 	FALL_KEY = :nVirtFallKey ")
.head 5 +  If not bOk
.head 6 -  Call SalMessageBox ( "Cannot revert changes on LST_ERF", "Warning", MB_Ok )
.head 6 -  Call SqlPrepareAndExecute( hSql, "rollback")
.head 6 -  Return FALSE
.head 5 -  ! revert command "insert into LST_ADM_TODO_ITEMS"
.head 5 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql, "
select 	ID
from 	LT_DETAIL
where 	LT_NR=:nLT 
and 	OP = 'I'
and 	TBNAME = 'LST_ADM_TODO_ITEMS'
into 	:nNR_Detail " )
.head 5 +  While SqlFetchNext( hSql, nFtch )
.head 6 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql1, "
select 	KEY1, KEY2, KEY3, KEY4
from 	LT_VALUES
where 	ID = :nNR_Detail
into	:nEinrichtId,  :nVirtFallKey, :nNewLstErfNr,  :nIdminItemNr  " ) 
.head 6 -  Call SqlFetchNext( hSql1, nFtch1 )
.head 6 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1,"
	Delete from  	LST_ADM_TODO_ITEMS
	where 	LST_ERF_NR = :nNewLstErfNr
	and 	EINRICHT_ID = :nEinrichtId
	and 	FALL_KEY = :nVirtFallKey
	and 	 ADMIN_ITEM_NR = :nIdminItemNr")
.head 5 +  If not bOk
.head 6 -  Call SalMessageBox ( "Cannot revert changes on LST_ADM_TODO_ITEMS", "Warning", MB_Ok )
.head 6 -  Call SqlPrepareAndExecute( hSql, "rollback")
.head 6 -  Return FALSE
.head 5 -  ! revert command "Update BETT_LOCKS"
.head 5 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql, "
select 	ID
from 	LT_DETAIL
where 	LT_NR=:nLT 
and 	OP = 'U'
and 	TBNAME = 'BETT_LOCKS'
into 	:nNR_Detail " )
.head 5 +  While SqlFetchNext( hSql, nFtch )
.head 6 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql1, "
select 	VALD, KEY1 
from 	LT_VALUES
where 	ID = :nNR_Detail
into	 :dt_BewZeit_Old,  :nLock_ID " ) 
.head 6 -  Call SqlFetchNext( hSql1, nFtch1 )
.head 6 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1,"
	Update 	BETT_LOKS  
	set	BIS = :dt_BewZeit_Old
	where 	LOCK_ID = :nLockID")
.head 5 +  If not bOk
.head 6 -  Call SalMessageBox ( "Cannot revert changes on BETT_LOCKS(Upd)", "Warning", MB_Ok )
.head 6 -  Call SqlPrepareAndExecute( hSql, "rollback")
.head 6 -  Return FALSE
.head 5 -  ! revert command "insert into BETT_LOCKS"
.head 5 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql, "
select 	ID
from 	LT_DETAIL
where 	LT_NR=:nLT 
and 	OP = 'I'
and 	TBNAME = 'BETT_LOCKS'
into 	:nNR_Detail " )
.head 5 +  While SqlFetchNext( hSql, nFtch )
.head 6 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql1, "
select 	KEY1 
from 	LT_VALUES
where 	ID = :nNR_Detail
into	:nLock_ID " ) 
.head 6 -  Call SqlFetchNext( hSql1, nFtch1 )
.head 6 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1,"
	delete from	BETT_LOCKS  
	where 	LOCK_ID = :nLock_ID")
.head 5 +  If not bOk
.head 6 -  Call SalMessageBox ( "Cannot revert changes on BETT_LOCKS(Ins)", "Warning", MB_Ok )
.head 6 -  Call SqlPrepareAndExecute( hSql, "rollback")
.head 6 -  Return FALSE
.head 5 -  ! revert command "insert into BEWEGUNG_PLAN"
.head 5 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql, "
select 	ID
from 	LT_DETAIL
where 	LT_NR=:nLT 
and 	OP = 'I'
and 	TBNAME = 'BEWEGUNG_PLAN'
into 	:nNR_Detail " )
.head 5 +  While SqlFetchNext( hSql, nFtch )
.head 6 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql1, "
select 	 KEY1, KEY2, KEY3  
from 	LT_VALUES
where 	ID = :nNR_Detail
into	:nEinrichtId, :nFallKey , :nLastBewNr  " ) 
.head 6 -  Call SqlFetchNext( hSql1, nFtch1 )
.head 6 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1,"
delete from	BEWEGUNG_PLAN  
where 	EINRICHT_ID=:nEinrichtId
and 	FALL_KEY= :nFallKey 
and 	BEW_NR = :nLastBewNr ")
.head 5 +  If not bOk
.head 6 -  Call SalMessageBox ( "Cannot revert changes on BEWENUNG_PLAN", "Warning", MB_Ok )
.head 6 -  Call SqlPrepareAndExecute( hSql, "rollback")
.head 6 -  Return FALSE
.head 5 -  ! revert command "insert into LST_ERF"
.head 5 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql, "
select 	ID
from 	LT_DETAIL
where 	LT_NR=:nLT 
and 	OP = 'I'
and 	TBNAME = 'LST_ERF'
into 	:nNR_Detail " )
.head 5 +  While SqlFetchNext( hSql, nFtch )
.head 6 -  Set bOk =bOk And  SqlPrepareAndExecute( hSql1, "
select 	 KEY1, KEY2, KEY3  
from 	LT_VALUES
where 	ID = :nNR_Detail
into	:nEinrichtId, :nFallKey , :nNewLstErf  " ) 
.head 6 -  Call SqlFetchNext( hSql1, nFtch1 )
.head 6 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1,"
delete from	LST_ERF  
where 	EINRICHT_ID=:nEinrichtId
and 	FALL_KEY= :nFallKey 
and 	LST_ERF_NR = :nNewLstErf ")
.head 5 +  If not bOk
.head 6 -  Call SalMessageBox ( "Cannot revert changes on LST_ERF)", "Warning", MB_Ok )
.head 6 -  Call SqlPrepareAndExecute( hSql, "rollback")
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  Set bOk = bOk and SqlPrepareAndExecute( hSql, "Update LT set STATUS = 2 where NR=:nLT " )
.head 5 +  If bOk
.head 6 -  Call SqlPrepareAndExecute( hSql, "commit")
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( hSql, "rollback")
.head 5 -  Call SqlDisconnect( hSql )
.head 5 -  Call SqlDisconnect( hSql1)
.head 5 -  Return TRUE
.head 3 +  Function: LT_Fet				! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nOrderId
.head 5 -  Number: nPosNo
.head 5 -  Receive Boolean: bIsDone
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	DONE
from	ANML_ORDER_INT_POS
where	ORDER_ID = :nOrderId
   and	POS_NR = :nPosNo
into	:bIsDone
" )
.head 5 -  Set bOk = bOk And SqlFetchNext( hSql, nFetch )
.head 5 -  Set bOk = SqlDisconnect( hSql ) And bOk
.head 5 -  Return bOk
.head 3 +  Function: LT_OpenViewer			! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 5 -  Window Handle: hfrmLT
.head 4 +  Actions
.head 5 -  ! Return TRUE
.head 5 +  If not hWndViewLT
.head 6 -  ! Call SalCreateWindow( frmLT, hWndStar2000 )
.head 6 -  Call SalCreateWindow( frmLTNew, hWndStar2000 )
.head 5 +  Else
.head 6 -  Call VisWinShow(hWndViewLT,SHOW_Normal)
.head 3 +  Function: LT_DeleteBew
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nNr
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Sql Handle: hSql1
.head 5 -  Number: nFetch
.head 5 -  Number: nFetch1
.head 5 -  Number: nFall
.head 5 -  Number: nBew
.head 5 -  Number: nMinCageNr
.head 5 -  Number: nUser
.head 5 -  Number: nCage
.head 5 -  Number: nCage1
.head 5 -  Number: nCage2
.head 5 -  Number: nCID
.head 5 -  String: sAbt
.head 5 -  String: sStat
.head 5 -  String: sBar
.head 5 -  String: sBaKey
.head 5 -  String: sGruppeKey
.head 5 -  String: sRFID
.head 5 -  String: sBett
.head 5 -  Number: nLst_Erf_Nr
.head 5 -  String: sStatOld
.head 5 -  String: sGruppeKeyOld
.head 5 -  String: sUpdateLst_Erf
.head 5 -  Number: nType
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 +  If Not GalConnect( hSql1 )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql1, "
select	TYPE
from	LT
where	NR=:nNr
  into	:nType
" )
.head 5 -  Call SqlFetchNext( hSql1, nFetch1 )
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	FALL_KEY,BEW_NR,RFID
from	LT_FALL
where	NR=:nNr
Order by BEW_NR desc
 into	:nFall,:nBew,:sRFID" )
.head 5 -  Set nFetch=0
.head 5 +  While SqlFetchNext( hSql, nFetch )
.head 6 +  If nFall and nBew
.head 7 -  Set bOk =  bOk and SqlPrepareAndExecute( hSql1, "
UPDATE LST_ERF k
set k.storniert='Y'	
where	k.Fall_Key=:nFall
and exists (select t.start from LT t where t.nr=:nNr and  k.erf_datum>=t.start and t.end>=k.erf_Datum)" )
.head 7 -  Set bOk =  bOk and SqlPrepareAndExecute( hSql1, "
delete	
from	BEWEGUNG
where	Fall_Key=:nFall
and BEW_NR=:nBew" )
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "
UPDATE	BEWEGUNG
set bew_zeit_bis=Null
where	Fall_Key=:nFall
and BEW_NR+1=:nBew" )
.head 7 -  Set nFetch1=0
.head 7 +  If TRUE
.head 8 -  Set sAbt=''
.head 8 -  Set sStat=''
.head 8 -  Set sBaKey=''
.head 8 -  Set nCage=NUMBER_Null
.head 8 -  Set nUser=NUMBER_Null
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "
select LAST_STAT_KEY,  LAST_GRUPPE_KEY from fall
where	Fall_Key=:nFall
into :sStatOld, :sGruppeKeyOld" )
.head 7 -  Call SqlFetchNext( hSql1, nFetch1 )
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "
select ABT_KEY,STAT_KEY,CAGE_NR,BA_KEY,BENUTZER_ID, GRUPPE_KEY,BETT_KEY
from	BEWEGUNG
where	Fall_Key=:nFall
and 	BEW_NR+1=:nBew
into :sAbt,:sStat,:nCage,:sBaKey,:nUser,:sGruppeKey,:sBett" )
.head 7 -  Call SqlFetchNext( hSql1, nFetch1 )
.head 7 -  Set nLst_Erf_Nr = 0
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "
select LST_ERF_NR from lst_erf
where	Stat_key=:sStatOld
and 	GRUPPE_KEY=:sGruppeKeyOld
into :nLst_Erf_Nr" )
.head 7 -  Call SqlFetchNext( hSql1, nFetch1 )
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "
select UNIQ_NR
from	GRUPPE 
where	Stat_key=:sStat
and 	GRUPPE_KEY=:sGruppeKey
into :nCage1" )
.head 7 -  Call SqlFetchNext( hSql1, nFetch1 )
.head 7 +  If nCage
.head 8 +  If nCage!=nCage1
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "select Min(uniq_nr)-1from GRUPPE
into :nMinCageNr" )
.head 9 -  Set bOk = bOk and SqlFetchNext( hSql1, nFetch )
.head 9 -  ! Set bOk = bOk and SqlPrepareAndExecute( hSql1, "update GRUPPE
set UNIQ_NR=:nMinCageNr, 
GRUPPE_BAR='"||code2from5Interleaved( nMinCageNr) ||"'
where	uniq_nr=:nCage" )
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "update GRUPPE
set UNIQ_NR=:nMinCageNr, 
GRUPPE_BAR=" || SalNumberToStrX( nMinCageNr, 0 ) || "
where	uniq_nr=:nCage" )
.head 9 -  Set sBar=code2from5Interleaved( nCage )
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "update GRUPPE
set UNIQ_NR=:nCage,
GRUPPE_BAR=:sBar
where	uniq_nr=:nCage1" )
.head 9 -  Set sBar=code2from5Interleaved( nCage1 )
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "update GRUPPE
set UNIQ_NR=:nCage1,
GRUPPE_BAR=:sBar
where	uniq_nr=:nMinCageNr" )
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "update GRUPPE
set RFID=''
where	uniq_nr=:nCage1" )
.head 7 -  Set bOk = bOk and  SqlPrepareAndExecute( hSql1, "update fall
set LAST_ABT_KEY=:sAbt,
LAST_STAT_KEY=:sStat,
LAST_CAGE_NR=:nCage,
LAST_BA_KEY=:sBaKey,
LAST_BENUTZER_ID=:nUser,
LAST_BEW_NR=(:nBew)-1,
LAST_GRUPPE_KEY=:sGruppeKey,
LAST_BETT_KEY=:sBett,
EE_DATUM=Null,
EE_TIME=Null
where	Fall_Key=:nFall" )
.head 7 +  If sRFID
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "update GRUPPE
set RFID=:sRFID,
RF_Abt_Key=:sAbt
where UNIQ_NR=:nCage
" )
.head 7 +  If nLst_Erf_Nr
.head 8 -  Set sUpdateLst_Erf = "Update lst_erf set  gruppe_key= :sGruppeKey,  stat_key=:sStat where stat_key=:sStatOld and gruppe_key= :sGruppeKeyOld"
.head 8 +  If nType != 5
.head 9 -  Set sUpdateLst_Erf = sUpdateLst_Erf || " and FALL_KEY= :nFall"
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1,  sUpdateLst_Erf)
.head 7 +  If bOk 
.head 8 -  Call SqlPrepareAndExecute( hSql1, "commit" )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( hSql1, "rollback" )
.head 5 -  Call SqlDisconnect( hSql )
.head 5 -  Call SqlDisconnect( hSql1 )
.head 5 -  Return TRUE
.head 3 +  Function: LT_DeleteCulling
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nNr
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Sql Handle: hSql1
.head 5 -  Number: nFetch
.head 5 -  Number: nFetch1
.head 5 -  Number: nFall
.head 5 -  Number: nBew
.head 5 -  Number: nUser
.head 5 -  Number: nCage
.head 5 -  Number: nCID
.head 5 -  String: sAbt
.head 5 -  String: sStat
.head 5 -  String: sBaKey
.head 5 -  String: sRFID
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 +  If Not GalConnect( hSql1 )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	FALL_KEY,BEW_NR,RFID
from	LT_FALL
where	NR=:nNr
Order by BEW_NR desc
 into	:nFall,:nBew,:sRFID" )
.head 5 -  Set nFetch=0
.head 5 +  While SqlFetchNext( hSql, nFetch )
.head 6 -  Set bOk = SqlPrepareAndExecute( hSql1, "update LE l
set l.TOD_DATUM=Null
where	l.le_id=(select f.LE_ID from fall f where Fall_Key=:nFall)" )
.head 6 -  Set nFetch1=0
.head 6 -  Set nCID=-1
.head 6 -  Set bOk = SqlPrepareAndExecute( hSql1, "
Select f.Culling_id from fall f where f.fall_Key=:nFall into :nCID
" )
.head 6 -  Call SqlFetchNext( hSql1, nFetch1 )
.head 6 +  If nCID>0
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
update	fall
set 	culling_id=null
where 	fall_key=:nFall
" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	Culling c
where	c.culling_id=:nCID and not exists(select f.culling_id from fall f where f.culling_id=:nCID )
" )
.head 6 -  Set bOk = SqlPrepareAndExecute( hSql1, "commit" )
.head 5 -  Call SqlDisconnect( hSql )
.head 5 -  Call SqlDisconnect( hSql1 )
.head 5 -  Return TRUE
.head 3 +  Function: LT_DeleteFall
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nNr
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Sql Handle: hSql1
.head 5 -  Number: nFetch
.head 5 -  Number: nFetch1
.head 5 -  Number: nFall
.head 5 -  Number: nLe
.head 5 -  Number: nDebit
.head 5 -  Number: nBank
.head 5 -  Number: nAdr
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 +  If Not GalConnect( hSql1 )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	FALL_KEY
from	LT_FALL
where	BEW_NR is null
and 	NR=:nNr
 into	:nFall" )
.head 5 -  Set nFetch=0
.head 5 +  While SqlFetchNext( hSql, nFetch )
.head 6 +  If nFall
.head 7 -  Set nFetch1=0
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
select l.LE_ID,DEBIT_INFO_ID,BANK_VERB_ID,ADRESSE_ID
from	LE l, fall f
where	f.Fall_Key=:nFall
and 	l.le_id=f.Le_id
into :nLe,:nDebit,:nBank,:nAdr" )
.head 7 -  Call SqlFetchNext( hSql1, nFetch1 )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	RELship_fall
where	Fall_Key=:nFall" )
.head 7 -  ! Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	RELationship r
where	not exists (select f.fall_key from relship_fall  f where r.relship_id=f.relship_id)" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
update	Litter_child
set FALL_KEY=Null,
NAME1=Null
where	Fall_Key=:nFall" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	FALL_EXP_MR
where	Fall_Key=:nFall" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	LST_PL_KUE
where	Fall_Key=:nFall" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	LST_PL
where	Fall_Key=:nFall" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	KUE_VERL
where	Fall_Key=:nFall" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	KUE
where	Fall_Key=:nFall" )
.head 7 -  ! Call SalMessageBox('FE',SalNumberToStrX(nFall,0),0)
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	FALL_EXPERIMENT
where	Fall_Key=:nFall" )
.head 7 -  ! Call SalMessageBox('FH',SalNumberToStrX(nFall,0),0)
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	FALL_HEALTH_STATUS
where	Fall_Key=:nFall" )
.head 7 -  ! Call SalMessageBox('F',SalNumberToStrX(nFall,0),0)
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	FALL
where	Fall_Key=:nFall" )
.head 7 -  ! Call SalMessageBox('LE',SalNumberToStrX(nFall,0),0)
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	LE
where	LE_ID=:nLe" )
.head 7 -  ! Call SalMessageBox('FE',SalNumberToStrX(nFall,0),0)
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	DEBIT_INFO
where	DEBIT_INFO_ID=:nDebit" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	BANK_VERB
where	BANK_VERB_ID=:nBank" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "
delete	
from	ADRESSE
where	ADRESSE_ID=:nAdr" )
.head 7 -  Set bOk = SqlPrepareAndExecute( hSql1, "commit" )
.head 5 -  Call SqlDisconnect( hSql )
.head 5 -  Call SqlDisconnect( hSql1 )
.head 5 -  Return TRUE
.head 3 +  Function: LT_SetToUndo
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nNr
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
update	LT
set 	STATUS=3
where	NR=:nNr" )
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "commit" )
.head 5 -  Set bOk = SqlDisconnect( hSql ) And bOk
.head 5 -  Return bOk
.head 3 +  Function: LT_LastUndo			! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nNrUndo
.head 5 -  Number: nType
.head 5 -  Number: nFetch
.head 5 -  FunctionalVar: oUndo
.head 6 -  Class: clsUndo
.head 5 -  Number: nRerturn
.head 5 -  String: sVars[1]
.head 4 +  Actions
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	MAX(NR) 
from	LT
where	USER_ID = :nUserId
and 	STATUS=1
into	:nNrUndo
" )
.head 5 -  Set bOk = bOk and SqlFetchNext(hSql,nFetch)
.head 5 -  Call SqlDisconnect(hSql)
.head 5 -  Call oUndo.Init()
.head 5 -  Set oUndo.nNr = nNrUndo
.head 5 +  If oUndo.CheckPossibleUndo( nType )
.head 6 -  Set nMsgBtn1 = 10004
.head 6 -  Set nMsgBtn2 = 10005
.head 6 -  Set nMsgBtn3 = 10034
.head 6 -  Set sVars[0] = oUndo.GetTypeName( nType )
.head 6 -  Set nRerturn = GalMessageBox(D_GetMessageStatic(10034), D_GetMessage(5018, sVars), MB_UserButtons3 )
.head 6 +  If nRerturn = IDYES
.head 7 +  If nType = 10
.head 8 -  Call LT_UndoPlanMating(nNrUndo)
.head 7 +  Else
.head 8 -  Call oUndo.Undo( nNrUndo )
.head 7 -  Call SalSendMsg(hWndStar2000, AM_Refresh, 11,0)
.head 6 +  Else If nRerturn = IDCANCEL
.head 7 -  Call LT_OpenViewer()
.head 5 -  Return TRUE
.head 3 +  Function: LT_CanUndo			! __Exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Sql Handle: hSql
.head 5 -  Number: nFetch
.head 5 -  Number: nNrUndo
.head 5 -  Number: nStatus
.head 4 +  Actions
.head 5 +  If Not GalConnect( hSql )
.head 6 -  Return FALSE
.head 5 -  Set bOk = SqlPrepareAndExecute( hSql, "
select	NR, status
from	LT
where	USER_ID = :nUserId
order by 1 desc
into	:nNrUndo, :nStatus
" )
.head 5 -  Set bOk = bOk and SqlFetchNext(hSql, nFetch)
.head 5 -  Call SqlDisconnect(hSql)
.head 5 -  Set bOk = bOk and (nNrUndo>0) and (nStatus=1)
.head 5 -  Return bOk
.head 3 -  !
.head 3 +  Function: TypeColOfType
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: sType
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If sType='CHAR' or sType='VARCHAR'
.head 6 -  Set sType='String'
.head 5 +  If sType='LONG' or sType='LONGVAR'
.head 6 -  Set sType='Long String'
.head 5 +  If sType='INTEGER' or sType='SMALLINT' or sType='FLOAT' or sType='DECIMAL'
.head 6 -  Set sType='Number'
.head 5 +  If sType='DATE' or sType='TIME' or sType='TIMESTMP'
.head 6 -  Set sType='Date/Time'
.head 5 -  Return sType
.head 2 +  Named Menus
.head 2 +  Class Definitions
.data RESOURCE 0 0 1 3070620336
0000: 830600008B040000 0000000000000000 0200001100FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F1D003C00 001963006C734765
0040: 6E657261006C5461 626C654272006F77 73654D61726B0040 000000020000000F
0060: 1900000001017803 0600000003880773 000000B001000000 1941000400000003
0080: C07803070000009E 8800010D00018036 0010000001000011 63026C4368696C64
00A0: 54EE614D005E0000 00030000006F1900 0901780A00000063 A6077300B4010000
00C0: 195900040003C278 0B0000009EA60001 4D001D0000961900 0178B00D000000A6
00E0: 4700010000030180 680000008602000C 636C0053716C4861 6E646C00659A0000
0100: 00050000DE001992 0001780500C600B8 0773680001000019 B3000400B6030600
0120: 3DB80001DB001D2C 00190001786D0700 B88F000100260036 0000194B00017808
0140: D8000000B8A30001 0000C14F00000019 12000178090000F6 00B8680001000001
0160: 88801D0000030010 000B636C42617380 6963576E644000EC 0002002D04000378
0180: 6D05002088097300 0001003600040019 4B00017806DB0020 A300010000210180
01A0: 1900000443000F63 6C473F466900656C 6422000000017A00 00194B000178071B
01C0: 00040A73A2000001 0000210180040000 05430012636C44E0 6174614669005072
01E0: 6F7065722200D100 0100005304000002 D87803060098640A 7300018D0001801D
0200: 91000600000C0044 465F4D7574617420 696F6E400000027A 0000888800000007
0220: 7803010100F41354 0B73920000010000 CD040019D2000178 08E600540B680001
0240: 0000018C801D0007 0000000A63436F6D 626F4048656C7040 0000F60200D60400
0260: 0376050011447300 000100009B040019 A500017806DC0000 11D1000100000001
0280: 8029000000080041 000563446161449A 00000500006F0400 6D030500632A1173
02A0: 00B4010000045900 040003DB06009E2A 00016D000800D604 0003B607002A6700
02C0: 0100830C00000004 B5000308ED002AD9 0001006010000000 19006901780A007B
02E0: 2A00340100000180 460400090000020B 53637265656E4C44 61220000F4010000
0300: D604000336060042 1166730001006301 800400040A000009 635261F0636B4461
0320: D1000100005B0400 03DF00984E117300 018D000180049100 0B000009C0436167
0340: 6544614700010000 6F04007D0300635A 1173003601000180 607D0000000C0008
0360: 0D635264696F4C00 697374426F789A00 D90005005B190001 DE78001074127300
0380: 0001006D00190096 19000178B6070074 4700010000833200 000019A500017808
03A0: ED0074D100010000 604B000000190069 017809007B740034 0100006400580000
03C0: 190001DA780A001E 740001008D000180 1911000D00000C63 0047554953657474
03E0: 69206E6773220000 017A0000194B0001 78081B00D21473A2 0000010000310180
0400: 36000E000000000B 63476C6F2062616C 5661735EA2000003 0000B70400BC0278
0420: 0031D814730001DA 0000042C00190001 786D0700D88F0001 0036001D00194B00
0440: 01780BDB00D8A300 0100003101800400 0F000000000A634D 4449004F7074696F
0460: 6E2200D100010000 5B040002D3190000 93730000018D0001 8004190010000663
0480: CC46696422E80001 00002D0400077855 0601D25648157300 0001000600
.enddata
.head 3 +  Functional Class: clsUndo
.head 4 -  Description:
.head 4 -  Derived From
.head 4 -  Class Variables
.head 4 +  Instance Variables
.head 5 -  Number: nNr
.head 5 -  Sql Handle: hSqlSelect
.head 5 -  Sql Handle: hSqlSelect1
.head 5 -  Sql Handle: hSqlUNDO
.head 5 -  Number: nType
.head 5 -  String: sInfoTxt
.head 5 -  String: sGruppe_Bar
.head 4 +  Functions
.head 5 +  Function: Init
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 +  If not hSqlSelect
.head 8 -  Call GalConnect( hSqlSelect )
.head 7 +  If not hSqlSelect1
.head 8 -  Call GalConnect( hSqlSelect1 )
.head 7 +  If not hSqlUNDO
.head 8 -  Call GalConnect( hSqlUNDO )
.head 5 +  Function: CheckPossibleUndo
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Receive Number: nType
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Sql Handle: hSqlCheck
.head 7 -  Boolean: bOk
.head 7 -  Number: nNRCheck
.head 7 -  Number: nFetch
.head 7 -  Number: nStatusCheck
.head 6 +  Actions
.head 7 -  Set bOk = GalConnect( hSqlCheck) 
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute( hSqlCheck, "select nr, status, type from lt where user_id=:nUserId order by nr desc into :nNRCheck, :nStatusCheck, :nType " )
.head 7 -  Set bOk = bOk and SqlFetchNext( hSqlCheck, nFetch )
.head 7 +  If bOk 
.head 8 -  Set bOk = ( (nNRCheck=nNr) and nStatusCheck=1)
.head 7 +  If hSqlCheck
.head 8 -  Call SqlDisconnect( hSqlCheck )
.head 7 -  Return bOk
.head 5 +  Function: Undo
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  Number: _nNr
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: sTBName
.head 7 -  String: sSqlSel
.head 7 -  Number: nFetch
.head 7 -  Boolean: bOk
.head 7 -  String: sNameTransaction
.head 6 +  Actions
.head 7 -  Call Init()
.head 7 -  Set nNr = _nNr
.head 7 +  If CheckPossibleUndo(nType)
.head 8 -  Set sSqlSel = "select distinct tbname from lt_detail where lt_nr=:nNr
into :sTBName "
.head 8 -  Set bOk = SqlPrepareAndExecute(hSqlUNDO, "lock table xlock")
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute( hSqlSelect, sSqlSel )
.head 8 +  While bOk and SqlFetchNext(hSqlSelect,nFetch)
.head 9 -  ! Call AddSQLCommand("lock table " || sTBName)
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "lock table "|| sTBName)
.head 8 -  Set sInfoTxt = "UNDO " || GetTypeName(nType) || ":"
.head 8 -  Set bOk = bOk and _Undo(  )
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute( hSqlUNDO, "Update lt set status = 2 where nr=:nNr " )
.head 8 +  If bOk 
.head 9 -  Call SqlCommit( hSqlUNDO )
.head 9 -  Call GalMessageBox("Undo", sInfoTxt || " successfully",0 )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( hSqlUNDO, "rollback" )
.head 9 -  Call GalMessageBox("Undo", sInfoTxt || " fail. ",0 )
.head 5 +  Function: Import
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: sSqlSel
.head 7 -  String: sTBName
.head 7 -  Boolean: bOk
.head 7 -  Number: nID_Detail 
.head 7 -  Number: nFetch
.head 7 -  String: sNameCol
.head 7 -  String: sVal
.head 7 -  Number: nVal
.head 7 -  Date/Time: dtVal
.head 7 -  Number: nKey1
.head 7 -  Number: nKey2
.head 7 -  Number: nKey3
.head 7 -  Number: nKey4
.head 7 -  Number: nKey5
.head 7 -  String: sOp
.head 7 -  Long String: lsVal
.head 6 +  Actions
.head 7 -  Set sSqlSel = "select id, tbname, op from lt_detail 
          where lt_nr=:nNr 
order by nr desc
into :nID_Detail, :sTBName, :sOp "
.head 7 -  Set bOk = SqlPrepareAndExecute(hSqlSelect, sSqlSel)
.head 7 -  Set sSqlSel = "select name, key1,key2,key3,key4,key5,vals, valn,vald from lt_values where id=:nID_Detail
into :sNameCol, :nKey1, :nKey2, :nKey3, :nKey4, :nKey5,:sVal, :nVal, :dtVal "
.head 7 -  Set bOk = bOk and SqlPrepare(hSqlSelect1, sSqlSel)
.head 7 +  While bOk and SqlFetchNext( hSqlSelect, nFetch )
.head 8 -  Set bOk = bOk and SqlExecute(hSqlSelect1)
.head 8 +  If sOp = 'I'
.head 9 -  Set bOk = bOk and SqlFetchNext(hSqlSelect1,nFetch )
.head 9 +  If sTBName = "BEWEGUNG"
.head 10 -  Set bOk = bOk and DeleteBew(nKey3,nKey1,nKey2)
.head 9 +  Else If sTBName = "RELSHIP_FALL"
.head 10 -  Set bOk = bOk and DeleteFallFromRelship(nKey3,nKey2,nKey1)
.head 9 +  Else If sTBName = "RELATIONSHIP"
.head 10 -  Set bOk = bOk and DeleteRelship(nKey1)
.head 9 +  Else If sTBName = "STRAIN"
.head 10 -  Set bOk = bOk and DeleteStrain(nKey1)
.head 9 +  Else If sTBName = "CULLING"
.head 10 -  Set bOk = bOk and DeleteCulling(nKey1)
.head 8 +  Else
.head 9 -  Set bOk = bOk and GetSQLCommand( sOp, nID_Detail, lsVal )
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO , lsVal)
.head 7 -  Return bOk
.head 5 +  Function: _Undo
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: sSqlSel
.head 7 -  String: sTBName
.head 7 -  Boolean: bOk
.head 7 -  Number: nID_Detail 
.head 7 -  Number: nFetch
.head 7 -  String: sNameCol
.head 7 -  String: sVal
.head 7 -  Number: nVal
.head 7 -  Date/Time: dtVal
.head 7 -  Number: nKey1
.head 7 -  Number: nKey2
.head 7 -  Number: nKey3
.head 7 -  Number: nKey4
.head 7 -  Number: nKey5
.head 7 -  String: sOp
.head 7 -  Long String: lsVal
.head 6 +  Actions
.head 7 -  Set sSqlSel = "select id, tbname, op from lt_detail 
          where lt_nr=:nNr 
order by nr desc
into :nID_Detail, :sTBName, :sOp "
.head 7 -  Set bOk = SqlPrepareAndExecute(hSqlSelect, sSqlSel)
.head 7 -  Set sSqlSel = "select name, key1,key2,key3,key4,key5,vals, valn,vald from lt_values where id=:nID_Detail
into :sNameCol, :nKey1, :nKey2, :nKey3, :nKey4, :nKey5,:sVal, :nVal, :dtVal "
.head 7 -  Set bOk = bOk and SqlPrepare(hSqlSelect1, sSqlSel)
.head 7 +  While bOk and SqlFetchNext( hSqlSelect, nFetch )
.head 8 -  Set bOk = bOk and SqlExecute(hSqlSelect1)
.head 8 +  If sOp = 'I'
.head 9 -  Set bOk = bOk and SqlFetchNext(hSqlSelect1,nFetch )
.head 9 +  If sTBName = "BEWEGUNG"
.head 10 -  Set bOk = bOk and DeleteBew(nKey3,nKey1,nKey2)
.head 9 +  Else If sTBName = "RELSHIP_FALL"
.head 10 -  Set bOk = bOk and DeleteFallFromRelship(nKey3,nKey2,nKey1)
.head 9 +  Else If sTBName = "RELATIONSHIP"
.head 10 -  Set bOk = bOk and DeleteRelship(nKey1)
.head 9 +  Else If sTBName = "STRAIN"
.head 10 -  Set bOk = bOk and DeleteStrain(nKey1)
.head 9 +  Else If sTBName = "CULLING"
.head 10 -  Set bOk = bOk and DeleteCulling(nKey1)
.head 9 +  Else If sTBName = "LITTER"
.head 10 -  Set bOk = bOk and DeleteLitter(nKey1)
.head 9 +  Else If sTBName = "LITTER_LSTERF"
.head 10 -  Set bOk = bOk and DeleteLitterServices(nKey1,nKey2, nKey4,nKey3,nKey5)
.head 9 +  Else If sTBName = "LITTER_CHILD"
.head 10 -  Set bOk = bOk and DeletePups(nKey1,nKey2)
.head 8 +  Else
.head 9 -  Set bOk = bOk and GetSQLCommand( sOp, nID_Detail, lsVal )
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO , lsVal)
.head 7 -  Return bOk
.head 5 +  Function: DeleteBew
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nEin
.head 7 -  Number: nFall
.head 7 -  Number: nBewNr
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 7 -  Number: nPrev_BewNr
.head 7 -  String: sPrev_BA_Key
.head 7 -  String: sPrev_AbtKey
.head 7 -  String: sPrev_Stat_Key
.head 7 -  String: sPrev_Gruppe
.head 7 -  String: sPrev_Bett
.head 7 -  Number: nPrev_CageNr
.head 7 -  Number: nPrev_ScrID
.head 7 -  Number: nPrev_RackID
.head 7 -  Number: nPrev_CageID
.head 7 -  Number: nPrev_Pos
.head 7 -  Number: nFetch
.head 6 +  Actions
.head 7 -  Set bOk = TRUE
.head 7 -  Call ShowText(sInfoTxt || "movement fall " || SalNumberToStrX(nFall,0)  )
.head 7 +  If nBewNr > 1
.head 8 -  Set bOk= bOk and SqlPrepareAndExecute(hSqlUNDO, "select bew_nr, ba_key, abt_key, stat_key,gruppe_key,bett_key,cage_nr,scr_id,rack_id,cage_id,pos_id  from bewegung
where einricht_id=:nEin
 and fall_key=:nFall
and bew_nr<:nBewNr and GELOESCHT='N'
order by bew_nr desc
into :nPrev_BewNr,:sPrev_BA_Key, :sPrev_AbtKey, :sPrev_Stat_Key, :sPrev_Gruppe,
:sPrev_Bett, :nPrev_CageNr, :nPrev_ScrID, :nPrev_RackID,
:nPrev_CageID, :nPrev_Pos " )
.head 8 -  Set bOk = bOk and SqlFetchNext(hSqlUNDO,nFetch )
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute( hSqlUNDO, "update fall set ee_datum='',
ee_time='', last_bew_nr=:nPrev_BewNr, last_ba_key=:sPrev_BA_Key,
last_abt_key=:sPrev_AbtKey, last_stat_key=:sPrev_Stat_Key,
last_gruppe_key=:sPrev_Gruppe, last_bett_key=:sPrev_Bett, 
last_scr_id=:nPrev_ScrID, last_cage_id=:nPrev_CageID, 
pos_id=:nPrev_Pos, last_cage_nr=:nPrev_CageNr
where einricht_id=:nEin and fall_key=:nFall " )
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute( hSqlUNDO, "update le set tod_datum='' where le_id = (select le_id from fall where EINRICHT_ID = :nEin and fall_key=:nFall) " )
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute( hSqlUNDO, "update bewegung set  BEW_ZEIT_BIS='' where EINRICHT_ID = :nEin and fall_key=:nFall and bew_nr=:nPrev_BewNr " )
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from lst_erf where EINRICHT_ID = :nEin and fall_key=:nFall and bew_nr=:nBewNr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from bewegung where EINRICHT_ID = :nEin and fall_key=:nFall and bew_nr=:nBewNr ")
.head 7 +  If nBewNr = 1
.head 8 -  Set bOk = bOk and DeleteFall(nFall, nEin)
.head 7 -  Return bOk
.head 5 +  Function: DeleteFallFromRelship
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nEin
.head 7 -  Number: nFall
.head 7 -  Number: nRelshipID
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 7 -  Boolean: bExists
.head 6 +  Actions
.head 7 -  Call ShowText(sInfoTxt ||  "fall " || SalNumberToStrX(nFall,0) || " from relship "  )
.head 7 -  Set bOk = SqlPrepareAndExecute(hSqlUNDO, "Delete from relship_fall where relship_id=:nRelshipID and fall_key=:nFall and EINRICHT_ID=:nEin ")
.head 7 -  Set bOk = bOk and SqlExists( "select * from relship_fall where relship_id=:nRelshipID", bExists )
.head 7 +  If not bExists
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "Delete from RELATIONSHIP where relship_id=:nRelshipID ")
.head 7 -  Return bOk
.head 5 +  Function: DeleteRelship
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nRelshipID
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 6 +  Actions
.head 7 -  Call ShowText(sInfoTxt ||  "relship " || SalNumberToStrX(nRelshipID,0)   )
.head 7 -  Set bOk = SqlPrepareAndExecute(hSqlUNDO, "Delete from relship_fall where relship_id=:nRelshipID")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "Delete from RELATIONSHIP where relship_id=:nRelshipID ")
.head 7 -  Return bOk
.head 5 +  Function: DeleteStrain
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nStrID
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 6 +  Actions
.head 7 -  Call ShowText(sInfoTxt ||  " strain " || SalNumberToStrX(nStrID,0)  )
.head 7 -  Set bOk = TRUE
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from strainparents where strain_id=:nStrID ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from strainparents where FATHERSTRAIN_ID=:nStrID ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from strainparents where MOTHERSTRAIN_ID=:nStrID ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from strain where ID=:nStrID ")
.head 7 -  Return bOk
.head 5 +  Function: DeleteCulling
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nCullingID
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 6 +  Actions
.head 7 -  Call ShowText(sInfoTxt ||  " culling " || SalNumberToStrX(nCullingID,0)  )
.head 7 -  Set bOk = TRUE
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "Update le set TOD_DATUM='' where le_id in (select le_id from fall where culling_id=:nCullingID ) ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "Update fall set culling_id='' where culling_id=:nCullingID ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from culling where culling_id=:nCullingID ")
.head 7 -  Return bOk
.head 5 +  Function: DeleteFall
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nFall
.head 7 -  Number: nEinr
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 6 +  Actions
.head 7 -  Set bOk = TRUE
.head 7 -  Call ShowText(sInfoTxt ||  " fall " || SalNumberToStrX(nFall,0)  )
.head 7 +  If nType!=4
.head 8 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from le where le_id = (select le_id from fall where fall_key=:nFall and EINRICHT_ID=:nEinr ) ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  fall_experiment where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  lst_erf where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  CAB_OCCUPY  where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  ZUS_ADRESSE  where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  ANML_DLVR_FALL  where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  UNFALL_DAT  where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  REQUEST  where fall_key=:nFall and FALL_EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  NEUGEBORENE   where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  FALL_MED_REC   where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  FALL_HEALTH_STATUS   where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  FALL_EXP_MR   where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  FALL_DIAG   where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  FALL_ACC   where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  FALL_OP    where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  FALL_PD    where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  KUE_VERL    where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  lst_pl_kue   where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  KUE    where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  rech_pos    where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  LST_PL    where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  fall where fall_key=:nFall and EINRICHT_ID=:nEinr ")
.head 7 -  Return bOk
.head 5 +  Function: DeleteLitter
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nLitterID
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 7 -  Sql Handle: hSql1
.head 7 -  Number: nFtch
.head 7 -  Number: nMother
.head 7 -  Number: nSrvNr
.head 6 +  Actions
.head 7 -  Set bOk = TRUE
.head 7 -  Call ShowText(sInfoTxt ||  " litter " || SalNumberToStrX(nLitterID,0)  )
.head 7 -  Set bOk = bOk and GalConnect(hSql1)
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSql1, "select fall_key, lst_erf_nr from litter_lsterf where litter_id=:nLitterID
into :nMother, :nSrvNr ")
.head 7 -  Set bOk = bOk and SqlPrepare(hSqlUNDO, "delete from lst_erf where fall_key=:nMother and lst_erf_nr=:nSrvNr ")
.head 7 +  While bOk and SqlFetchNext( hSql1, nFtch )
.head 8 -  Set bOk = bOk and SqlExecute(hSqlUNDO)
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  LITTER_LSTERF where litter_id=:nLitterID ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  LITTER_LSTERF where litter_id=:nLitterID ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  LITTER_CHILD where litter_id=:nLitterID ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  LITTER where litter_id=:nLitterID ")
.head 7 +  If hSql1
.head 8 -  Call SqlDisconnect( hSql1 )
.head 7 -  Return bOk
.head 5 +  Function: DeletePups
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nLitterID
.head 7 -  Number: nPup
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 7 -  Sql Handle: hSql1
.head 7 -  Number: nFtch
.head 7 -  Number: nMother
.head 7 -  Number: nSrvNr
.head 6 +  Actions
.head 7 -  Set bOk = TRUE
.head 7 -  Call ShowText(sInfoTxt ||  " litter " || SalNumberToStrX(nLitterID,0)  )
.head 7 -  Set bOk = bOk and GalConnect(hSql1)
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSql1, "select fall_key, lst_erf_nr from litter_lsterf where litter_id=:nLitterID and child_nr=:nPup
into :nMother, :nSrvNr ")
.head 7 -  Set bOk = bOk and SqlPrepare(hSqlUNDO, "delete from lst_erf where fall_key=:nMother and lst_erf_nr=:nSrvNr ")
.head 7 +  While bOk and SqlFetchNext( hSql1, nFtch )
.head 8 -  Set bOk = bOk and SqlExecute(hSqlUNDO)
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  LITTER_LSTERF where litter_id=:nLitterID and child_nr=:nPup ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  LITTER_CHILD where litter_id=:nLitterID and child_nr=:nPup")
.head 7 +  If hSql1
.head 8 -  Call SqlDisconnect( hSql1 )
.head 7 -  Return bOk
.head 5 +  Function: DeleteLitterServices
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nLitterID
.head 7 -  Number: nChild
.head 7 -  Number: nEinr
.head 7 -  Number: nFall
.head 7 -  Number: nNr
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 6 +  Actions
.head 7 -  Set bOk = TRUE
.head 7 -  Call ShowText(sInfoTxt ||  " litter " || SalNumberToStrX(nLitterID,0)  )
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  LST_ERF where einricht_id=:nEinr and fall_key=:nFall and  lst_erf_nr=:nNr ")
.head 7 -  Set bOk = bOk and SqlPrepareAndExecute(hSqlUNDO, "delete from  LITTER_LSTERF where Litter_id=:nLitterID and child_nr=:nChild and einricht_id=:nEinr and fall_key=:nFall and  lst_erf_nr=:nNr ")
.head 7 -  Return bOk
.head 5 +  Function: GetSQLCommand
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  String: sOp
.head 7 -  Number: nNr
.head 7 -  Receive Long String: lsSQL
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Sql Handle: hSql1
.head 7 -  String: sVal
.head 7 -  Number: nVal
.head 7 -  Date/Time: dtVal
.head 7 -  Long String: lsVal
.head 7 -  String: sNameCol
.head 7 -  Boolean: bOk
.head 7 -  String: sWhere
.head 7 -  Number: nFetch
.head 7 -  String: sTable
.head 7 -  String: sType
.head 7 -  Number: nMinUniqNR
.head 6 +  Actions
.head 7 +  If GalConnect( hSql1)
.head 8 +  If sOp = "B"
.head 9 -  Set bOk =  SqlPrepareAndExecute( hSql1, "select v.name, v.vals, v.valn, v.vald, d.tbname from lt_detail  d
join lt_values v on (v.id=d.id) where d.id=:nNr
and v.name in (select colname from sysadm.syspkconstraints where creator='SYSADM' and name=d.tbname)
into :sNameCol,:sVal, :nVal, :dtVal, :sTable " )
.head 9 -  Set sWhere = " where 1=1 "
.head 9 +  While bOk and SqlFetchNext( hSql1, nFetch )
.head 10 -  Set sWhere = sWhere || " and " || sNameCol || "="
.head 10 +  If sVal 
.head 11 -  Set sWhere = sWhere || "'" || sVal || "'"
.head 10 +  Else If nVal 
.head 11 -  Set sWhere = sWhere || SalNumberToStrX(nVal,0) 
.head 10 +  Else If dtVal 
.head 11 -  Call SalDateToStr( dtVal, sVal )
.head 11 -  Set sWhere = sWhere || "'" || sVal || "'"
.head 9 +  If sTable = "GRUPPE"
.head 10 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1,"select min(uniq_nr)-1 from gruppe into :nMinUniqNR " )
.head 10 -  Set bOk = bOk and SqlFetchNext( hSql1, nFetch )
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "select l.name,l.vals, l.valn,l.vald,l.valls, s.COLTYPE from lt_values l
left join sysadm.syscolumns s on (s.tbcreator='SYSADM' and s.tbname=:sTable and s.name=l.name) 
where l.id=:nNr
and l.name not in (select colname from sysadm.syspkconstraints where creator='SYSADM' and name=:sTable)
into :sNameCol,:sVal, :nVal, :dtVal,:lsVal, :sType " )
.head 9 -  Set lsSQL = "Update " || sTable || " set "
.head 9 +  While bOk and SqlFetchNext( hSql1, nFetch )
.head 10 -  Set lsSQL = lsSQL || sNameCol || "="
.head 10 -  Set sType = TypeColOfType(sType)
.head 10 +  If sType='String'
.head 11 +  If sTable = "GRUPPE" and sNameCol ="GRUPPE_BAR"
.head 12 +  If sGruppe_Bar
.head 13 -  ! Set sVal = sGruppe_Bar
.head 13 -  Set lsSQL = lsSQL || ":sGruppe_Bar"
.head 12 +  Else
.head 13 -  Set lsSQL = lsSQL || "'" || sVal || "'"
.head 11 +  Else
.head 12 -  Set lsSQL = lsSQL || "'" || sVal || "'"
.head 10 +  Else If sType='Number'
.head 11 +  If sTable = "GRUPPE" and sNameCol ="UNIQ_NR"
.head 12 +  If nVal <0
.head 13 -  Set nVal = nMinUniqNR
.head 13 -  Set sGruppe_Bar = SalNumberToStrX( nMinUniqNR, 0 )
.head 12 +  Else
.head 13 -  Set sGruppe_Bar = code2from5Interleaved( nVal )
.head 11 +  If nVal != NUMBER_Null
.head 12 -  Set lsSQL = lsSQL || SalNumberToStrX(nVal,0) 
.head 11 +  Else
.head 12 -  Set lsSQL = lsSQL || "''" 
.head 10 +  Else If sType='Date/Time'
.head 11 -  Call SalDateToStr( dtVal, sVal )
.head 11 -  Set lsSQL = lsSQL || "'" || sVal || "'"
.head 10 +  Else
.head 11 -  Set lsSQL = lsSQL || "'" || lsVal || "'"
.head 10 -  Set lsSQL = lsSQL ||", "
.head 9 -  Call SalStrLeft( lsSQL, SalStrLength( lsSQL ) - 2, lsSQL )
.head 9 -  Set lsSQL = lsSQL || "
" || sWhere
.head 8 +  Else If sOp = "D"
.head 9 -  Set bOk = SqlPrepareAndExecute(hSql1, "select tbname from lt_detail where id=:nNr into :sTable ")
.head 9 -  Set bOk = bOk and SqlFetchNext(hSql1, nFetch)
.head 9 -  Set lsSQL = "Insert into " || sTable || "( "
.head 9 -  Set sWhere = ""
.head 9 -  Set bOk = bOk and SqlPrepareAndExecute( hSql1, "select l.name,l.vals, l.valn,l.vald, s.coltype from lt_values l
left join sysadm.syscolumns s on (s.tbcreator='SYSADM' and s.tbname=:sTable and s.name=l.name)  where l.id=:nNr
into :sNameCol,:sVal, :nVal, :dtVal, :sType  " )
.head 9 +  While bOk and SqlFetchNext( hSql1, nFetch )
.head 10 -  Set lsSQL = lsSQL || sNameCol || ","
.head 10 -  Set sType = TypeColOfType(sType)
.head 10 +  If sType='String'
.head 11 -  Set sWhere = sWhere || "'" || sVal || "',"
.head 10 +  Else If sType='Number'
.head 11 -  Set sWhere = sWhere || SalNumberToStrX(nVal,0) || ","
.head 10 +  Else If sType='Date/Time'
.head 11 -  Call SalDateToStr( dtVal, sVal )
.head 11 -  Set sWhere = sWhere || "'" || sVal || "',"
.head 9 -  Call SalStrLeft( lsSQL, SalStrLength( lsSQL ) - 1, lsSQL )
.head 9 -  Call SalStrLeft( sWhere, SalStrLength( sWhere ) - 1, sWhere )
.head 9 -  Set lsSQL = lsSQL || ") values ( " || sWhere || " )"
.head 8 -  Call SqlDisconnect( hSql1 )
.head 7 +  Else
.head 8 -  Set bOk = FALSE
.head 7 -  Return bOk
.head 5 +  Function: ShowText
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  String: sShowTxt
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 +  If hWndUndoInfo
.head 8 -  Call frmUndoBar.SetText( sShowTxt )
.head 5 +  Function: GetTypeName
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  String:
.head 6 +  Parameters
.head 7 -  Number: nTypeCheck
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: sNameType
.head 6 +  Actions
.head 7 +  Select Case nTypeCheck
.head 8 +  Case 1
.head 9 -  Set sNameType = "Mating"
.head 9 -  Break
.head 8 +  Case 2
.head 9 -  Set sNameType = "Discharge"
.head 9 -  Break
.head 8 +  Case 3
.head 9 -  Set sNameType = "Import"
.head 9 -  Break
.head 8 +  Case 4
.head 9 -  Set sNameType = "Weaning litter"
.head 9 -  Break
.head 8 +  Case 5
.head 9 -  Set sNameType = "Shift"
.head 9 -  Break
.head 8 +  Case 6
.head 9 -  Set sNameType = "Move Group"
.head 9 -  Break
.head 8 +  Case 7
.head 9 -  Set sNameType = "Move Single"
.head 9 -  Break
.head 8 +  Case 8
.head 9 -  Set sNameType = "Litter"
.head 9 -  Break
.head 8 +  Case 9
.head 9 -  Set sNameType = "Culling"
.head 9 -  Break
.head 8 +  Default
.head 9 -  Break
.head 7 -  Return sNameType
.head 3 +  Functional Class: oFallUndo
.head 4 -  Description:
.head 4 -  Derived From
.head 4 -  Class Variables
.head 4 +  Instance Variables
.head 5 -  Number: Ein_id
.head 5 -  Number: nFall
.head 5 -  Number: nBew[*]
.head 5 -  Number: nCullingID
.head 4 -  Functions
.head 2 +  Default Classes
.head 3 -  MDI Window:
.head 3 -  Form Window: cBaseForm
.head 3 -  Dialog Box:
.head 3 -  Table Window:
.head 3 -  Quest Window:
.head 3 -  Data Field:
.head 3 -  Spin Field:
.head 3 -  Multiline Field: clsMultilineField
.head 3 -  Pushbutton: cBtn
.head 3 -  Radio Button: clsRadioButton
.head 3 -  Option Button:
.head 3 -  ActiveX:
.head 3 -  Check Box: clsCheckBox
.head 3 -  Child Table: clsChildTableList
.head 3 -  Quest Child Window: cQuickDatabase
.head 3 -  List Box:
.head 3 -  Combo Box:
.head 3 -  Picture: cQuickPicture
.head 3 -  Vertical Scroll Bar:
.head 3 -  Horizontal Scroll Bar:
.head 3 -  Column:
.head 3 -  Background Text:
.head 3 -  Group Box:
.head 3 -  Line:
.head 3 -  Frame:
.head 3 -  Custom Control:
.head 2 +  Application Actions
.head 3 +  On SAM_AppStartup
.head 4 +  If Not App_ReadExeArguments( )
.head 5 -  Call SalQuit( )
.head 4 -  Call SalCreateWindow( frmLTNew, hWndNULL )
.head 3 +  On SAM_AppExit
.head 4 -  Call StopAllProcessesAndConnections(  )
.head 1 +  Form Window: frmLT
.head 2 -  Class: clsParentChildTablesBrowse
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: 135
.head 2 -  Icon File:
.head 2 -  Accessories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Display Style? Class Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Class Default
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  Allow Child Docking? Class Default
.head 3 -  Docking Orientation: Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left: Default
.head 4 -  Top: Default
.head 4 -  Width:  Class Default
.head 4 -  Width Editable? Class Default
.head 4 -  Height: Class Default
.head 4 -  Height Editable? Class Default
.head 3 -  Form Size
.head 4 -  Width:  Class Default
.head 4 -  Height: Class Default
.head 4 -  Number of Pages: Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Docking Toolbar? Class Default
.head 4 -  Toolbar Docking Orientation: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Resizable? Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 17
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsParentChildTablesBrowse
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 1
.head 5 -  Window Location and Size
.head 6 -  Left: Class Default
.head 6 -  Top: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 18
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsParentChildTablesBrowse
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 2
.head 5 -  Window Location and Size
.head 6 -  Left: Class Default
.head 6 -  Top: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFirst
.head 5 -  Class Child Ref Key: 19
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsParentChildTablesBrowse
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 3
.head 5 -  Window Location and Size
.head 6 -  Left: Class Default
.head 6 -  Top: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrev
.head 5 -  Class Child Ref Key: 20
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsParentChildTablesBrowse
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 4
.head 5 -  Window Location and Size
.head 6 -  Left: Class Default
.head 6 -  Top: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbNext
.head 5 -  Class Child Ref Key: 21
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsParentChildTablesBrowse
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 5
.head 5 -  Window Location and Size
.head 6 -  Left: Class Default
.head 6 -  Top: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbLast
.head 5 -  Class Child Ref Key: 22
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsParentChildTablesBrowse
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 6
.head 5 -  Window Location and Size
.head 6 -  Left: Class Default
.head 6 -  Top: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 -  Message Actions
.head 2 +  Contents
.head 3 +  Pushbutton: pbSep
.head 4 -  Class Child Ref Key: 3
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsParentChildTablesBrowse
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: 7
.head 4 -  Window Location and Size
.head 5 -  Left: Class Default
.head 5 -  Top: Class Default
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Button Appearance: Class Default
.head 4 -  Message Actions
.head 3 +  Child Table: tblParent
.head 4 -  Class Child Ref Key: 4
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsParentChildTablesBrowse
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: Class Default
.head 6 -  Top: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colNr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 9
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDescr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 10
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: String
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 11
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: String
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colStatus
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 12
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colBlock
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 13
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colStart
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 14
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEnd
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 15
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colUserId
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 16
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colType
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 17
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 3 -  Background Text: 8
.head 4 -  Resource Id: 28544
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.188"
.head 5 -  Top: 1.927"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Child Table: tblChild
.head 4 -  Class Child Ref Key: 5
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsParentChildTablesBrowse
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: Class Default
.head 6 -  Top: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colFall_Key
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 19
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colBewNr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 20
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 3 -  Background Text: 18
.head 4 -  Resource Id: 28545
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.188"
.head 5 -  Top: 1.927"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call Initialize( "
select	l.NR,l.User_Id,l.Type,l.Start,l.End,l.status,t.Descr,b.BENUTZER_NAME
	from	LT l,LT_TYPES t,BENUTZER b
where	l.Type=t.Type (+)
and l.USER_ID=b.BENUTZER_ID
order by	l.NR
into	:frmLT.tblParent.colNr,
	:frmLT.tblParent.colUserId, :frmLT.tblParent.colType,
	:frmLT.tblParent.colStart, :frmLT.tblParent.colEnd,
	:frmLT.tblParent.colStatus, :frmLT.tblParent.colDescr, :frmLT.tblParent.colName ",
"
select	f.FAll_Key, f.Bew_Nr	
from	LT_FALL f
where	f.Nr = :frmLT.tblParent.colNr
order by	1
into	:frmLT.tblChild.colFall_Key, :frmLT.tblChild.colBewNr
	 " )
.head 4 -  Call SalSendClassMessage( SAM_Create, 0, 0 )
.head 4 -  Set hWndViewLT = hWndForm
.head 3 +  On SAM_Close
.head 4 -  Call SalSendClassMessage( SAM_Close, 0, 0 )
.head 4 -  Set hWndViewLT = hWndNULL
.head 1 +  Dialog Box: dlgWait
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Wait please.
.head 2 -  Accessories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Etched
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modeless
.head 3 -  Allow Dock to Parent? No
.head 3 -  Docking Orientation: All
.head 3 -  Window Location and Size
.head 4 -  Left: Default
.head 4 -  Top: Default
.head 4 -  Width:  2.675"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 0.521"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 3 -  Resizable? No
.head 3 -  Vertical Scroll? Yes
.head 3 -  Horizontal Scroll? Yes
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Docking Toolbar? No
.head 4 -  Toolbar Docking Orientation: Top | Bottom
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Resizable? No
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Data Field: dfText
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: -0.013"
.head 6 -  Top: 0.094"
.head 6 -  Width:  2.5"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: MS Sans Serif
.head 5 -  Font Size: 8
.head 5 -  Font Enhancement: None
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow( hWndItem )
.head 4 -  Set dfText = "Please wait until undo is completed"
.head 4 -  Call SalSetFocus( hWndItem )
.head 1 +  Form Window: frmLTNew
.head 2 -  Class: clsSimpleForm
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: 388
.head 2 -  Icon File:
.head 2 -  Accessories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Display Style? Class Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Class Default
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  Allow Child Docking? Class Default
.head 3 -  Docking Orientation: Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left: Default
.head 4 -  Top: Default
.head 4 -  Width:  11.7"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 5.302"
.head 4 -  Height Editable? Class Default
.head 3 -  Form Size
.head 4 -  Width:  Class Default
.head 4 -  Height: Class Default
.head 4 -  Number of Pages: Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: 0.281"
.head 4 -  Size Editable? Class Default
.head 4 -  Docking Toolbar? Class Default
.head 4 -  Toolbar Docking Orientation: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Resizable? Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsPbExit
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 1
.head 5 -  Window Location and Size
.head 6 -  Left: 0.0"
.head 6 -  Top: 0.0"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsPbRefresh
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 2
.head 5 -  Window Location and Size
.head 6 -  Left: 0.388"
.head 6 -  Top: 0.0"
.head 6 -  Width:  0.3"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsPbDelete
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 3
.head 5 -  Window Location and Size
.head 6 -  Left: 0.7"
.head 6 -  Top: 0.0"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUndo
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cBtn
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 4
.head 5 -  Window Location and Size
.head 6 -  Left: 1.088"
.head 6 -  Top: 0.0"
.head 6 -  Width:  0.35"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 +  If tblLTTransaction.colStatus = 1
.head 8 -  Set sVars[0] = frmLTNew.tblLTTransaction.colType
.head 8 +  If GalMessageBox(D_GetMessageStatic(10034), D_GetMessage(5018, sVars) , MB_YesNo ) = IDYES
.head 9 -  Call SalCreateWindowEx( frmUndoBar, hWndForm, nW/2-2.5, nH/2-0.15, 5, 0.3, CREATE_AsChild)
.head 9 +  If hWndUndoInfo
.head 10 -  Call frmUndoBar.SetText( "Undo" )
.head 9 +  If SalStrToNumber(frmLTNew.tblLTTransaction.colTypeNum)  = 10
.head 10 -  Call LT_UndoPlanMating(frmLTNew.tblLTTransaction.colID)
.head 9 +  Else
.head 10 -  Call oUndo.Undo( tblLTTransaction.colID )
.head 9 -  ! Call LT_UndoPlanMating(tblLTTransaction.colID)
.head 9 -  Call SalSendMsg( hWndForm, AM_Refresh , 0, 0 )
.head 9 -  Call SalDestroyWindow( hWndUndoInfo )
.head 9 -  Call SalSendMsg(hWndStar2000, AM_Refresh, 11,0)
.head 4 +  Pushbutton: pbGoToFall
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cBtn
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 5
.head 5 -  Window Location and Size
.head 6 -  Left: 1.4"
.head 6 -  Top: 0.0"
.head 6 -  Width:  0.35"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Button Appearance: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Call SalSendMsg(  hWndStar2000, AM_OpenFall, 1, GalSetAsWinMsgLParam_Number( tblDetail.colFallKey ) )
.head 6 +  On AM_Refresh
.head 7 +  If hWndStar2000 and tblDetail.colFallKey
.head 8 -  Call pbGoToFall.Enable(  )
.head 7 +  Else
.head 8 -  Call pbGoToFall.Disable(  )
.head 4 +  Check Box: cbShowLastLT
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: clsCheckBox
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 6
.head 5 -  Window Location and Size
.head 6 -  Left: 2.088"
.head 6 -  Top: 0.05"
.head 6 -  Width:  2.1"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Call SalSendMsg( hWndForm, AM_Refresh, 0,0 )
.head 2 +  Contents
.head 3 +  Child Table: tblLTTransaction
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsChildTableList
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.0"
.head 6 -  Top: 0.0"
.head 6 -  Width:  9.8"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 1.406"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colID
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 10
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colType
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 11
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colStatus
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 12
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colStart
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 13
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: DateTime
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEnd
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 14
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: DateTime
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colUserName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 15
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTypeNum
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumn_Hidden
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: ClearColorRows
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nRow
.head 6 +  Actions
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow( tblLTTransaction, nRow, 0, 0 )
.head 8 -  Call VisTblSetRowColorEx(tblLTTransaction, nRow, COLOR_Black ,COLOR_White)
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  ! Call SalSendClassMessage(SAM_Create, wParam, lParam)
.head 6 -  Set nPopulateMode = TBL_FillAll
.head 6 -  Call Initialize("
select nr, t.descr, l.status, l.start,l.end, u.benutzer_name, t.type  
from lt l
join lt_types t on (l.type=t.type)
join benutzer u on (u.benutzer_id=l.user_id) 
where l.user_id=:nUserId
and nr >= (select max(l2.nr)*:frmLTNew.cbShowLastLT from lt l2 where l2.user_id=:nUserId)
order by nr desc
into 	:frmLTNew.tblLTTransaction.colID,
	:frmLTNew.tblLTTransaction.colType,
	:frmLTNew.tblLTTransaction.colStatus,
	:frmLTNew.tblLTTransaction.colStart,
	:frmLTNew.tblLTTransaction.colEnd,
	:frmLTNew.tblLTTransaction.colUserName
	:frmLTNew.tblLTTransaction.colTypeNum ")
.head 5 +  On SAM_RowSetContext
.head 6 -  Call SalSendMsg( tblDetail, AM_Refresh, 0, 0 )
.head 6 +  If SalTblQueryContext( tblLTTransaction ) = 0 and tblLTTransaction.colStatus = 1
.head 7 -  Call SalEnableWindow( pbUndo )
.head 6 +  Else
.head 7 -  Call SalDisableWindow( pbUndo )
.head 5 +  On SAM_FetchRowDone
.head 6 +  If colStatus = 2
.head 7 -  Call VisTblSetRowColorEx(tblLTTransaction, lParam,COLOR_Black ,COLOR_Red )
.head 6 +  Else
.head 7 +  If SalTblQueryContext( tblLTTransaction ) > 0
.head 8 -  Call VisTblSetRowColorEx(tblLTTransaction, lParam, COLOR_Black ,COLOR_Green)
.head 7 +  Else
.head 8 -  Call VisTblSetRowColorEx(tblLTTransaction, lParam, COLOR_Black ,COLOR_White)
.head 5 +  On AM_Refresh
.head 6 -  ! Call SalTblReset ( tblLTTransaction )
.head 6 -  Call ClearColorRows()
.head 6 -  Call SalSendClassMessage( AM_Refresh, wParam, lParam )
.head 3 -  Background Text: 8
.head 4 -  Resource Id: 50891
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.0"
.head 5 -  Top: 0.0"
.head 5 -  Width:  0.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.0"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Child Table: tblDetail
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsChildTableList
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.0"
.head 6 -  Top: 1.417"
.head 6 -  Width:  9.8"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 2.49"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colID
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 16
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colLTID
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 17
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 18
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colOperation
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 19
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTbName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 20
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 21
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colInfo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: 22
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: 5000
.head 6 -  Data Type: Long String
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFallKey
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: clsColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: Detail
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nFetch
.head 7 -  Long String: sText
.head 7 -  String: sDate
.head 7 -  Number: nFall
.head 6 +  Actions
.head 7 +  If colOperation = "Insert"
.head 8 +  If SqlExecute( hSqlDetailIns )
.head 9 -  Set sText = ""
.head 9 +  If SqlFetchNext( hSqlDetailIns, nFetch )
.head 10 +  If colTbName= "BEWEGUNG"
.head 11 -  Set sText = "Fall_Key = " || SalNumberToStrX(nKey1,0) || " Bew_Nr="|| SalNumberToStrX(nKey2,0)
.head 11 -  Set nFall = nKey1
.head 10 +  Else If colTbName = 'LITTER_LSTERF'
.head 11 -  Set sText = "Litter = " || SalNumberToStrX(nKey1,0) || " Pup="|| SalNumberToStrX(nKey2,0) || " MotherID= "|| SalNumberToStrX(nKey3,0) || " Service Nr= "|| SalNumberToStrX(nKey5,0)
.head 11 -  Set nFall = nKey3
.head 10 +  Else If colTbName = 'RELATIONSHIP'
.head 11 +  If SalStrScan( sVal, "MATE" )>-1
.head 12 -  Set sText = "Mating_ID=" || SalNumberToStrX(nKey1,0)
.head 11 +  Else
.head 12 -  Set sText = "Family_ID=" || SalNumberToStrX(nKey1,0)
.head 10 +  Else If colTbName = 'RELSHIP_FALL'
.head 11 +  If SalStrScan( sVal, "MATE" )>-1
.head 12 -  Set sText = "Mating_ID=" || SalNumberToStrX(nKey1,0) || " Fall_Key= " || SalNumberToStrX(nKey2,0)
.head 11 +  Else If SalStrScan( sVal, "CHILD" )>-1
.head 12 -  Set sText = "FAMILY_ID=" || SalNumberToStrX(nKey1,0) || " Fall_Key= " || SalNumberToStrX(nKey2,0)
.head 11 +  Else If SalStrScan( sVal, "PARENT" )>-1
.head 12 -  Set sText = "FAMILY_ID=" || SalNumberToStrX(nKey1,0) || " Fall_Key(parents)= " || SalNumberToStrX(nKey2,0)
.head 11 -  Set nFall = nKey2
.head 10 +  Else If colTbName = 'LITTER'
.head 11 -  Set sText = "Litter=" || SalNumberToStrX(nKey1,0) 
.head 10 +  Else If colTbName = 'LITTER_CHILD'
.head 11 -  Set sText = "Litter=" || SalNumberToStrX(nKey1,0) || " Pup= " || SalNumberToStrX(nKey2,0)
.head 10 +  Else If colTbName = 'CULLING'
.head 11 -  Set sText = "Culling ID=" || SalNumberToStrX(nKey1,0) 
.head 10 +  Else If colTbName = 'STRAIN'
.head 11 -  Set sText = "Strain ID=" || SalNumberToStrX(nKey1,0) || ' Name = ' || sVal
.head 9 -  Set colInfo = sText
.head 9 -  Set colName = sName
.head 9 +  If sName = "STRAIN ID"
.head 10 -  Set colName ="Create new strain"
.head 9 +  Else If sName = "CULLING_ID"
.head 10 -  Set colName ="Create culling"
.head 9 +  Else If sName = "RELSHIP_ID"
.head 10 +  If SalStrScan( sVal, "MATE" )>-1
.head 11 -  Set colName ="Create mating"
.head 10 +  Else
.head 11 -  Set colName ="Create Family"
.head 9 +  Else If sName = "MOVE FALL"
.head 10 -  Set colName ="Create movement"
.head 9 +  Else If sName = "FALL IN RELLSHIP"
.head 10 +  If SalStrScan( sVal, "MATE" )>-1
.head 11 -  Set colName ="Add fall in mating"
.head 10 +  Else If SalStrScan( sVal, "CHILD" )>-1
.head 11 -  Set colName ="Add fall in family"
.head 10 +  Else If SalStrScan( sVal, "PARENT" )>-1
.head 11 -  Set colName ="Add fall in family"
.head 9 +  Else If sName = "LITTER_ID"
.head 10 -  Set colName ="Create litter"
.head 9 +  Else If sName = "PUP"
.head 10 -  Set colName ="Add pups"
.head 9 +  Else If sName = "CHILD SERVICE"
.head 10 -  Set colName ="Add service on pups"
.head 7 +  Else
.head 8 +  If SqlExecute( hSqlDetail )
.head 9 -  Set sText = ""
.head 9 +  While SqlFetchNext( hSqlDetail, nFetch )
.head 10 +  If colOperation = 'Delete'
.head 11 +  If colTbName = 'LST_ERF'
.head 12 +  If sName = 'FALL_KEY' or sName = 'LST_KEY' or sName='LST_ERF_NR'
.head 13 -  Set sText = sText || sName || "="
.head 13 +  If sVal
.head 14 -  Set sText = sText || sVal || " "
.head 13 +  Else If nVal
.head 14 -  Set sText = sText || SalNumberToStrX( nVal,0) || " "
.head 13 +  Else If dtVal
.head 14 -  Call SalDateToStr( dtVal, sDate )
.head 14 -  Set sText = sText || sDate || " "
.head 13 +  Else
.head 14 -  Set sText = sText || " "
.head 12 +  If sName = 'FALL_KEY'
.head 13 -  Set nFall = nVal
.head 11 +  Else
.head 12 -  Set sText = sText || sName || "="
.head 12 +  If sVal
.head 13 -  Set sText = sText || sVal || " "
.head 12 +  Else If nVal
.head 13 -  Set sText = sText || SalNumberToStrX( nVal,0) || " "
.head 12 +  Else If dtVal
.head 13 -  Call SalDateToStr( dtVal, sDate )
.head 13 -  Set sText = sText || sDate || " "
.head 12 +  Else
.head 13 -  Set sText = sText || " "
.head 12 +  If sName = 'FALL_KEY'
.head 13 -  Set nFall = nVal
.head 10 +  Else
.head 11 -  Set sText = sText || sName || "="
.head 11 +  If sVal
.head 12 -  Set sText = sText || sVal || " "
.head 11 +  Else If nVal
.head 12 -  Set sText = sText || SalNumberToStrX( nVal,0) || " "
.head 11 +  Else If dtVal
.head 12 -  Call SalDateToStr( dtVal, sDate )
.head 12 -  Set sText = sText || sDate || " "
.head 11 +  Else
.head 12 -  Set sText = sText || " "
.head 11 +  If sName = 'FALL_KEY'
.head 12 -  Set nFall = nVal
.head 9 -  Set colInfo = sText
.head 7 +  If nFall
.head 8 -  Set tblDetail.colFallKey = nFall
.head 5 +  Function: ShowRow
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 6 +  Actions
.head 7 -  Set bOk = FALSE
.head 7 +  If tblLTTransaction.colType = 'Import'
.head 8 +  If colOperation = "Insert"
.head 9 +  ! If colTbName = 'BEWEGUNG' or colTbName = 'LST_ERF' or colTbName = 'RELATIONSHIP'
.head 10 -  Set bOk = TRUE
.head 9 -  Set bOk = TRUE
.head 7 +  Else If tblLTTransaction.colType = 'Wean Litter'
.head 8 +  If colOperation = "Insert"
.head 9 +  ! If colTbName != 'FALL_EXPERIMENT'
.head 10 -  Set bOk = TRUE
.head 9 -  Set bOk = TRUE
.head 8 +  Else If colOperation = "Update"
.head 9 +  If colTbName != 'LITTER_CHILD'
.head 10 -  Set bOk = TRUE
.head 8 +  Else
.head 9 -  Set bOk = TRUE
.head 7 +  Else
.head 8 -  Set bOk = TRUE
.head 7 -  Return bOk
.head 5 +  Function: DeleteRows
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nRow
.head 6 +  Actions
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow( tblDetail, nRow, ROW_MarkDeleted, 0 )
.head 8 -  Call SalTblSetContext( tblDetail, nRow )
.head 8 -  Call SalTblDeleteRow( tblDetail, nRow , TBL_Adjust  )
.head 4 +  Window Variables
.head 5 -  Sql Handle: hSqlDetail
.head 5 -  Sql Handle: hSqlDetailIns
.head 5 -  String: sName
.head 5 -  Number: nVal
.head 5 -  String: sVal
.head 5 -  Date/Time: dtVal
.head 5 -  Long String: lsVal
.head 5 -  Number: nRowDel
.head 5 -  Number: nKey1
.head 5 -  Number: nKey2
.head 5 -  Number: nKey3
.head 5 -  Number: nKey4
.head 5 -  Number: nKey5
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalSendClassMessage(SAM_Create, wParam, lParam)
.head 6 -  Set nPopulateMode = TBL_FillAll
.head 6 -  If SqlConnect(hSqlDetail)
.head 6 -  If SqlConnect(hSqlDetailIns)
.head 6 -  Call Initialize("
select id, lt_nr, nr, op, tbname from lt_detail where lt_nr=:frmLTNew.tblLTTransaction.colID
order by nr
into 	:frmLTNew.tblDetail.colID,
	:frmLTNew.tblDetail.colLTID,
	:frmLTNew.tblDetail.colNr,
	:frmLTNew.tblDetail.colOperation,
	:frmLTNew.tblDetail.colTbName ")
.head 5 +  On SAM_Close
.head 6 +  If hSqlDetail
.head 7 -  Call SqlDisconnect(hSqlDetail)
.head 6 +  If hSqlDetailIns
.head 7 -  Call SqlDisconnect(hSqlDetailIns)
.head 5 +  On AM_Refresh
.head 6 -  Call SqlPrepare(hSqlDetail, "select name, vals,valn,vald, valls from lt_values
where name!='EINRICHT_ID' and id=:frmLTNew.tblDetail.colID 
into :frmLTNew.tblDetail.sName, :frmLTNew.tblDetail.sVal, :frmLTNew.tblDetail.nVal, :frmLTNew.tblDetail.dtVal, :frmLTNew.tblDetail.lsVal ")
.head 6 -  Call SqlPrepare(hSqlDetailIns, "select name, key1, key2, key3, key4, key5, vals from lt_values
where id=:frmLTNew.tblDetail.colID 
into :frmLTNew.tblDetail.sName, :frmLTNew.tblDetail.nKey1, :frmLTNew.tblDetail.nKey2, :frmLTNew.tblDetail.nKey3, :frmLTNew.tblDetail.nKey4, :frmLTNew.tblDetail.nKey5, :frmLTNew.tblDetail.sVal ")
.head 6 -  Call SalSendClassMessage(AM_Refresh, wParam, lParam)
.head 6 -  Call DeleteRows()
.head 5 +  On SAM_FetchRowDone
.head 6 +  If colOperation = 'I'
.head 7 -  Set colOperation = "Insert"
.head 6 +  Else If colOperation = 'B'
.head 7 -  Set colOperation = "Update"
.head 6 +  Else If colOperation = 'D'
.head 7 -  Set colOperation = "Delete"
.head 6 +  If ShowRow()
.head 7 -  Call Detail()
.head 6 +  Else
.head 7 -  Call SalTblSetRowFlags( tblDetail, SalTblQueryContext( tblDetail ), ROW_MarkDeleted , TRUE )
.head 5 +  On SAM_RowSetContext
.head 6 -  Call SalSendMsg( pbGoToFall , AM_Refresh, 0, 0 )
.head 3 -  Background Text: 9
.head 4 -  Resource Id: 50892
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.0"
.head 5 -  Top: 0.0"
.head 5 -  Width:  0.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.0"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 2 +  Functions
.head 3 +  Function: Resize
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nW
.head 5 -  Number: nH
.head 5 -  Number: nW1
.head 5 -  Number: nH1
.head 5 -  Number: nX1
.head 5 -  Number: nY1
.head 5 -  Number: nX2
.head 5 -  Number: nY2
.head 5 -  Number: nXDelta
.head 5 -  Number: nYDelta
.head 4 +  Actions
.head 5 -  Call GetClientRect( frmLTNew, nX1,nY1, nX2, nY2 )
.head 5 -  Call SalGetWindowSize( frmLTNew , nW1, nH1 )
.head 5 -  Set nH=SalPixelsToFormUnits( frmLTNew, nY2, TRUE )
.head 5 -  Set nW=SalPixelsToFormUnits( frmLTNew, nX2, FALSE )
.head 5 -  Call GetWindowRect( tblLTTransaction, nX1, nY1, nX2, nY2 )
.head 5 -  Call SalGetWindowSize( tblLTTransaction , nW1, nH1 )
.head 5 -  Call SalSetWindowSize(tblLTTransaction , nW, nH1)
.head 5 -  Set nH = nH - nH1
.head 5 -  Call SalGetWindowSize( tblDetail , nW1, nH1 )
.head 5 -  Call SalSetWindowSize(tblDetail , nW, nH)
.head 3 +  Function: ScaleTables
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nKoef
.head 5 -  Number: nKoefBtn
.head 5 -  String: sFontName
.head 5 -  Number: nFontSize
.head 5 -  Number: nFontEnh
.head 4 +  Actions
.head 5 -  Set nKoef = GetKoefToobar()
.head 5 -  ! Set nKoefBtn = nKoef/nKoefToolbarSave
.head 5 -  Set nKoefBtn = nKoef
.head 5 -  Call SalFontGet(tblLTTransaction, sFontName, nFontSize, nFontEnh )
.head 5 -  Call SalFontSet ( tblLTTransaction, sFontName, nFontSize*nKoefBtn, nFontEnh )
.head 5 -  Call SalFontGet(tblDetail, sFontName, nFontSize, nFontEnh )
.head 5 -  Call SalFontSet ( tblDetail, sFontName, nFontSize*nKoefBtn, nFontEnh )
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  Sql Handle: hSqlDel
.head 3 -  Number: nW
.head 3 -  Number: nH
.head 3 -  FunctionalVar: oUndo
.head 4 -  Class: clsUndo
.head 3 -  String: sVars[1]
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendClassMessage(SAM_Create, wParam, lParam)
.head 4 +  If nUserId != 0
.head 5 -  Call pbDel.Hide(  )
.head 4 -  Set cbShowLastLT = 1
.head 4 +  If GalConnect(hSqlDel)
.head 5 -  Call SqlPrepare( hSqlDel, "Delete from lt where nr = :frmLTNew.tblLTTransaction.colID" )
.head 5 -  Call SqlSetParameter( hSqlDel, DBP_AUTOCOMMIT, TRUE, s1 )
.head 4 -  Set hWndViewLT = hWndForm
.head 3 +  On SAM_CreateComplete
.head 4 -  Call SalSendClassMessage(SAM_CreateComplete, wParam, lParam)
.head 4 -  Call ScaleTables()
.head 4 -  Call SalSetWindowText( pbGoToFall, "" )
.head 4 -  Call SalSetWindowText( pbUndo, "" )
.head 4 -  Call SalSendMsg(hWndForm, AM_Refresh, 0,0)
.head 3 +  On SAM_Close
.head 4 +  If hSqlDel
.head 5 -  Call SqlDisconnect( hSqlDel )
.head 4 -  Set hWndViewLT = hWndNULL
.head 4 -  Call SalSendClassMessage(SAM_Close, wParam, lParam)
.head 3 +  On GM_NEED_TOOLBAR_RESIZE
.head 4 -  Return TRUE
.head 3 +  On AM_Refresh
.head 4 -  Call SalSendMsg( tblLTTransaction , AM_Refresh, 0, 0 )
.head 4 -  Call SalSendMsg( pbGoToFall , AM_Refresh, 0, 0 )
.head 4 +  If SalTblQueryContext( tblLTTransaction ) = 0 and tblLTTransaction.colStatus = 1
.head 5 -  Call SalEnableWindow( pbUndo )
.head 4 +  Else
.head 5 -  Call SalDisableWindow( pbUndo )
.head 3 +  On AM_Delete
.head 4 -  Call SqlExecute( hSqlDel )
.head 4 -  Call SalSendMsg( tblLTTransaction , AM_Refresh, 0, 0 )
.head 4 -  Call SalSendMsg( tblDetail , AM_Refresh, 0, 0 )
.head 3 +  On WM_SIZE
.head 4 -  Call Resize(  )
.head 1 +  Form Window: frmUndoBar
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Icon File:
.head 2 -  Accessories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? No
.head 3 -  Minimizable? No
.head 3 -  Allow Child Docking? No
.head 3 -  Docking Orientation: All
.head 3 -  System Menu? No
.head 3 -  Resizable? No
.head 3 -  Window Location and Size
.head 4 -  Left: Default
.head 4 -  Top: Default
.head 4 -  Width:  2.575"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 0.677"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Docking Toolbar? No
.head 4 -  Toolbar Docking Orientation: Top | Bottom
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Resizable? No
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Data Field: dfText
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: -0.013"
.head 6 -  Top: 0.094"
.head 6 -  Width:  1.6"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Corbel
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: None
.head 5 -  Text Color: Default
.head 5 -  Background Color: System Window Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 2 +  Functions
.head 3 +  Function: Load
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nW
.head 5 -  Number: nH
.head 4 +  Actions
.head 5 -  Call SalGetWindowSize( hWndForm, nW, nH )
.head 5 -  Call SalSetWindowLoc( dfText, 0, 0 )
.head 5 -  Call SalSetWindowSize(dfText, nW, nH)
.head 3 +  Function: SetText
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: _sText
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Set sText = _sText
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  String: sText
.head 3 -  String: sTime
.head 3 -  Number: nCount
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call Load(  )
.head 4 -  Call SalTimerSet( hWndForm, 10, 1000 )
.head 4 -  Set hWndUndoInfo = hWndForm
.head 3 +  On SAM_Destroy
.head 4 -  Set hWndUndoInfo = hWndNULL
.head 3 +  On SAM_Timer
.head 4 -  Call SalTimerKill( hWndForm, 10 )
.head 4 -  Set nCount = nCount + 1
.head 4 +  If nCount>5
.head 5 -  Set nCount =  1
.head 4 +  If nCount =  1
.head 5 -  Set sTime = '.'
.head 4 +  Else If nCount =  2
.head 5 -  Set sTime = '..'
.head 4 +  Else If nCount =  3
.head 5 -  Set sTime = '...'
.head 4 +  Else If nCount =  4
.head 5 -  Set sTime = '....'
.head 4 +  Else If nCount =  5
.head 5 -  Set sTime = '.....'
.head 4 -  Set dfText = sText || sTime
.head 4 -  Call SalTimerSet( hWndForm, 10, 1000 )
